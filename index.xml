<?xml-stylesheet href="/rss.xsl" type="text/xsl"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>redbunny</title><link>https://www.okrust.com/</link><description>Recent content on redbunny</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><copyright>2022-2023</copyright><lastBuildDate>Thu, 10 Aug 2023 12:16:10 +0800</lastBuildDate><atom:link href="https://www.okrust.com/index.xml" rel="self" type="application/rss+xml"/><item><title>linux service编写</title><link>https://www.okrust.com/posts/linux/services/</link><pubDate>Thu, 10 Aug 2023 12:16:10 +0800</pubDate><guid>https://www.okrust.com/posts/linux/services/</guid><description>redbunny https://www.okrust.com/posts/linux/services/ -&lt;h2 id="编写脚本">编写脚本&lt;/h2>
&lt;p>示例:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72;font-weight:bold">[&lt;/span>Unit&lt;span style="color:#ff7b72;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#79c0ff">Description&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>hugo test
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#79c0ff">After&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>network.target
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72;font-weight:bold">[&lt;/span>Service&lt;span style="color:#ff7b72;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#79c0ff">Type&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>simple
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#79c0ff">User&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>root
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#79c0ff">Group&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>root
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#79c0ff">WorkingDirectory&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>/home/xxxx/code/blog
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#79c0ff">KillMode&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>control-group
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#79c0ff">Restart&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>no
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#79c0ff">ExecStart&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>hugo server -D
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#79c0ff">StandardOutput&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>file:/path/to/service.log
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#79c0ff">StandardError&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>file:/path/to/error.log
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72;font-weight:bold">[&lt;/span>Install&lt;span style="color:#ff7b72;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#79c0ff">WantedBy&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>multi-user.target &lt;span style="color:#8b949e;font-style:italic"># 多用户&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>可以看见服务的&lt;code>Target&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#执行&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ls -ratl /etc/systemd/system | grep wants
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#输出&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>drwxr-xr-x &lt;span style="color:#a5d6ff">2&lt;/span> root root &lt;span style="color:#a5d6ff">4096&lt;/span> 8月24日 05:20 getty.target.wants
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>drwxr-xr-x &lt;span style="color:#a5d6ff">2&lt;/span> root root &lt;span style="color:#a5d6ff">4096&lt;/span> 8月24日 05:26 sysinit.target.wants
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>drwxr-xr-x &lt;span style="color:#a5d6ff">2&lt;/span> root root &lt;span style="color:#a5d6ff">4096&lt;/span> 8月24日 05:26 graphical.target.wants
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>drwxr-xr-x &lt;span style="color:#a5d6ff">2&lt;/span> root root &lt;span style="color:#a5d6ff">4096&lt;/span> 8月24日 05:26 bluetooth.target.wants
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>drwxr-xr-x &lt;span style="color:#a5d6ff">2&lt;/span> root root &lt;span style="color:#a5d6ff">4096&lt;/span> 8月24日 05:26 printer.target.wants
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>drwxr-xr-x &lt;span style="color:#a5d6ff">2&lt;/span> root root &lt;span style="color:#a5d6ff">4096&lt;/span> 8月24日 05:26 systemd-coredump@.service.wants
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>drwxr-xr-x &lt;span style="color:#a5d6ff">2&lt;/span> root root &lt;span style="color:#a5d6ff">4096&lt;/span> 8月24日 05:26 network-online.target.wants
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>drwxr-xr-x &lt;span style="color:#a5d6ff">2&lt;/span> root root &lt;span style="color:#a5d6ff">4096&lt;/span> 8月24日 09:02 sockets.target.wants
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>drwxr-xr-x &lt;span style="color:#a5d6ff">2&lt;/span> root root &lt;span style="color:#a5d6ff">4096&lt;/span> 8月27日 06:09 timers.target.wants
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>drwxr-xr-x &lt;span style="color:#a5d6ff">2&lt;/span> root root &lt;span style="color:#a5d6ff">4096&lt;/span> 8月27日 06:09 multi-user.target.wants
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="模块解释">模块解释&lt;/h3>
&lt;p>[Unit]区块：启动顺序与依赖关系&lt;/p>
&lt;h4 id="服务描述">服务描述：&lt;/h4>
&lt;ul>
&lt;li>Description：给出当前服务的简单描述&lt;/li>
&lt;li>Documentation：给出文档位置&lt;/li>
&lt;/ul>
&lt;h4 id="启动顺序">启动顺序：&lt;/h4>
&lt;ul>
&lt;li>After：定义xxx.service应该在哪些target或service服务之后启动&lt;/li>
&lt;li>Before：定义xxx.service应该在哪些target或service服务之前启动&lt;/li>
&lt;/ul>
&lt;h4 id="依赖关系">依赖关系：&lt;/h4>
&lt;ul>
&lt;li>Wants：表示xxx.service与定义的服务存在“弱依赖”关系，即指定的服务启动失败或停止运行不影响xxx的允行&lt;/li>
&lt;li>Requires：则表示”强依赖”关系，即指定服务启动失败或异常退出，那么xxx也必须退出；反之xxx启动则指定服务也会启动&lt;/li>
&lt;/ul>
&lt;h3 id="service区块启动行为定义">[Service]区块：启动行为定义&lt;/h3>
&lt;h4 id="启动命令">启动命令：&lt;/h4>
&lt;ul>
&lt;li>EnvironmentFile：指定当前服务的环境参数文件(路径)，如EnviromentFile=-/etc/sysconfig/xxx，连词号表示抑制错误，即发生错误时，不影响其他命令的执行&lt;/li>
&lt;li>Environment：后面接多个不同的shell变量，如Environment=DATA_DIR=/dir/data&lt;/li>
&lt;li>User：设置服务运行的用户&lt;/li>
&lt;li>Group：设置服务运行的用户组&lt;/li>
&lt;li>WorkingDirectory：设置服务运行的路径&lt;/li>
&lt;li>Exec*：各种与执行相关的命令
&lt;ul>
&lt;li>ExecStart：定义启动服务时执行的命令&lt;/li>
&lt;li>ExecStop：定义停止服务时执行的命令&lt;/li>
&lt;li>ExecStartPre：定义启动服务前执行的命令&lt;/li>
&lt;li>ExecStartPost：定义启动服务后执行的命令&lt;/li>
&lt;li>ExecStopPost：定义停止服务后执行的命令&lt;/li>
&lt;li>ExecReload：定义重启服务时执行的命令&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="启动类型">启动类型：&lt;/h4>
&lt;ul>
&lt;li>Type：字段定义启动类型，可以设置的值如下
&lt;ul>
&lt;li>simple（默认值）：ExecStart字段启动的进程为主进程，即直接启动服务进程&lt;/li>
&lt;li>forking：ExecStart字段将以fork()方式启动，此时父进程将会退出，子进程将成为主进程（例如用shell脚本启动服务进程）&lt;/li>
&lt;li>oneshot：类似于simple，但只执行一次，Systemd 会等它执行完，才启动其他服务&lt;/li>
&lt;li>dbus：类似于simple，但会等待 D-Bus 信号后启动&lt;/li>
&lt;li>notify：类似于simple，启动结束后会发出通知信号，然后 Systemd 再启动其他服务&lt;/li>
&lt;li>idle：类似于simple，但是要等到其他任务都执行完，才会启动该服务。一种使用场合是为让该服务的输出，不与其他服务的输出相混合&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>RemainAfterExit：设为yes，表示进程退出以后，服务仍然保持执行&lt;/li>
&lt;/ul>
&lt;h3 id="重启行为">重启行为：&lt;/h3>
&lt;ul>
&lt;li>KillMode：定义 Systemd 如何停止服务，可以设置的值如下
&lt;ul>
&lt;li>control-group（default）：当前控制组里面的所有子进程，都会被杀掉&lt;/li>
&lt;li>process：只杀主进程&lt;/li>
&lt;li>mixed：主进程将收到 SIGTERM 信号，子进程收到 SIGKILL 信号&lt;/li>
&lt;li>none：没有进程会被杀掉，只是执行服务的 stop 命令&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Restart：定义了服务退出后，Systemd 的重启方式，可以设置的值如下（对于守护进程，推荐设为on-failure。对于那些允许发生错误退出的服务，可以设为on-abnormal）
&lt;ul>
&lt;li>no（default）：退出后不会重启&lt;/li>
&lt;li>on-success：只有正常退出时（退出状态码为0），才会重启&lt;/li>
&lt;li>on-failure：非正常退出时（退出状态码非0），包括被信号终止和超时，才会重启&lt;/li>
&lt;li>on-abnormal：只有被信号终止和超时，才会重启&lt;/li>
&lt;li>on-abort：只有在收到没有捕捉到的信号终止时，才会重启&lt;/li>
&lt;li>on-watchdog：超时退出，才会重启&lt;/li>
&lt;li>always：不管是什么退出原因，总是重启&lt;/li>
&lt;li>RestartSec：表示 Systemd 重启服务之前，需要等待的秒数&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>StandardOutput: 输出程序正常日志&lt;/li>
&lt;li>StandardError: 输出程序错误日志
&lt;ul>
&lt;li>file:/path/xx.log：以文件形式保存&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="install区块服务安装定义">[Install]区块：服务安装定义&lt;/h3>
&lt;ul>
&lt;li>WantedBy：表示该服务所在的 Target&lt;/li>
&lt;/ul>
&lt;p>Target的含义是服务组，如WantedBy=multi-user.target指的是该服务所属于multi-user.target。当执行systemctl enable xxx.service命令时，xxx.service的符号链接就会被创建在/etc/systemd/system/multi-user.target目录下。&lt;/p>
&lt;p>可以通过systemctl get-default命令查看系统默认启动的target，一般为multi-user或者是graphical。因此配置好相应的WantedBy字段，可以实现服务的开机启动&lt;/p>
&lt;h3 id="推荐执行">推荐执行&lt;/h3>
&lt;ul>
&lt;li>如果是shell 启动 service-&amp;gt;Type:forking&lt;/li>
&lt;li>二进制启动 service-&amp;gt;Type:simple&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>&lt;a href="https://qgrain.github.io/2020/05/12/%E7%BC%96%E5%86%99systemd%E6%9C%8D%E5%8A%A1%E8%84%9A%E6%9C%AC/">参考文档1&lt;/a>&lt;/p>
&lt;/blockquote>
- https://www.okrust.com/posts/linux/services/ - 2022-2023</description></item><item><title>linux权限快速了解</title><link>https://www.okrust.com/posts/linux/permissions/</link><pubDate>Mon, 07 Aug 2023 15:16:10 +0800</pubDate><guid>https://www.okrust.com/posts/linux/permissions/</guid><description>redbunny https://www.okrust.com/posts/linux/permissions/ -&lt;h2 id="linux权限">linux权限&lt;/h2>
&lt;h3 id="文件权限">文件权限&lt;/h3>
&lt;p>基本的权限表示
&lt;img src="https://www.okrust.com/linux/permissions.jpg" alt="权限">&lt;/p>
&lt;p>文件类型分几种：&lt;/p>
&lt;ul>
&lt;li>&lt;code>-&lt;/code> 则表示文件&lt;/li>
&lt;li>&lt;code>l&lt;/code> 则表示链接文件，&lt;/li>
&lt;li>&lt;code>b&lt;/code> 则表示设备文件中的可随机存取设备，&lt;/li>
&lt;li>&lt;code>c&lt;/code> 则表示为设备文件中的一次性读取设备(键盘、鼠标)。&lt;/li>
&lt;/ul>
&lt;h3 id="改变系统权限和属性">改变系统权限和属性&lt;/h3>
&lt;p>我们现在知道文件权限对于一个系统安全的重要性了，现在就要聊一聊如何修改文件权限了。常用的修改文件权限的指令有&lt;/p>
&lt;ul>
&lt;li>chgrp ：改变文件所属群组&lt;/li>
&lt;li>chown：改变文件所有者&lt;/li>
&lt;li>chmod：改变文件权限&lt;/li>
&lt;/ul>
&lt;h4 id="chgrp">chgrp&lt;/h4>
&lt;p>chgrp 就是 change group 的缩写，我觉得李纳斯把缩写用到了极致，这也许是我们现在对于缩写这么流行的原因。chgrp 能够改变文件群组，不过，要改变群组的话，要被改变的群组名称要在 /etc/group 文件内存在才行，否则就会显示错误。&lt;/p>
&lt;h4 id="chown">chown&lt;/h4>
&lt;p>既然 chgrp 能够改变文件群组，那么 chown 能够改变文件所有者，同样也需要注意的是，文件所有者必须是系统中存在的账号，也就是在 /etc/passwd 这个文件中有记录的使用者名称才可改变。除此之外，chown 还可以直接修改群组名称。&lt;/p>
&lt;p>语法:&lt;/p>
&lt;blockquote>
&lt;p>chown [可选项] user[:group] file&amp;hellip;&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>使用权限：root
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>说明：
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72;font-weight:bold">[&lt;/span>可选项&lt;span style="color:#ff7b72;font-weight:bold">]&lt;/span> : 同上文chmod
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>user : 新的文件拥有者的使用者
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>group : 新的文件拥有者的使用者群体&lt;span style="color:#ff7b72;font-weight:bold">(&lt;/span>group&lt;span style="color:#ff7b72;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>示例:&lt;/p>
&lt;ul>
&lt;li>置文件 d.key、e.scrt的拥有者设为 users 群体的 ubuntu&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>chown ubuntu:users file d.key e.scrt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>设置当前目录下与子目录下的所有文件的拥有者为 users 群体的 James&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>chown -R James:users *
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="chmod">chmod&lt;/h4>
&lt;p>变更文件权限使用的是 chmod 这个指令，但是，权限的设置有两种方式，可以分别使用数字或者符号进行权限变更。&lt;/p>
&lt;p>使用数组修改权限
如：&lt;/p>
&lt;ul>
&lt;li>rwx = 4 + 2 + 1 = 7&lt;/li>
&lt;li>rw = 4 + 2 = 6&lt;/li>
&lt;li>rx = 4 +1 = 5&lt;/li>
&lt;/ul>
&lt;p>即:&lt;/p>
&lt;ul>
&lt;li>若要同时设置 rwx (可读写运行） 权限则将该权限位 设置 为 4 + 2 + 1 = 7&lt;/li>
&lt;li>若要同时设置 rw-（可读写不可运行）权限则将该权限位 设置 为 4 + 2 = 6&lt;/li>
&lt;li>若要同时设置 r-x（可读可运行不可写）权限则将该权限位 设置 为 4 +1 = 5&lt;/li>
&lt;/ul>
&lt;p>上面我们提到，每个文件都可以针对三个粒度，设置不同的rwx(读写执行)权限。即我们可以用用三个8进制数字分别表示 拥有者 、群组 、其它组( u、 g 、o)的权限详情，并用chmod直接加三个8进制数字的方式直接改变文件权限。语法格式为 ：&lt;/p>
&lt;blockquote>
&lt;p>chmod &amp;lt;ugo&amp;gt; file&amp;hellip;&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>其中
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>u,g,o各为一个数字，分别代表User、Group、及Other的权限。
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>相当于简化版的
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>chmod &lt;span style="color:#79c0ff">u&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>权限,g&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>权限,o&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>权限 file...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>而此处的权限将用8进制的数字来表示User、Group、及Other的读、写、执行权限
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>示例:&lt;/p>
&lt;ul>
&lt;li>设置所有人可以读写及执行&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>chmod &lt;span style="color:#a5d6ff">777&lt;/span> file &lt;span style="color:#ff7b72;font-weight:bold">(&lt;/span>等价于 chmod &lt;span style="color:#79c0ff">u&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>rwx,g&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>rwx,o&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>rwx file 或 chmod &lt;span style="color:#79c0ff">a&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>rwx file&lt;span style="color:#ff7b72;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>设置拥有者可读写，其他人不可读写执行&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>chmod &lt;span style="color:#a5d6ff">600&lt;/span> file &lt;span style="color:#ff7b72;font-weight:bold">(&lt;/span>等价于 chmod &lt;span style="color:#79c0ff">u&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>rw,g&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>---,o&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>--- file 或 chmod &lt;span style="color:#79c0ff">u&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>rw,go-rwx file &lt;span style="color:#ff7b72;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>参考文章: &lt;a href="https://blog.csdn.net/u013197629/article/details/73608613">https://blog.csdn.net/u013197629/article/details/73608613&lt;/a>&lt;/p>
&lt;/blockquote>
- https://www.okrust.com/posts/linux/permissions/ - 2022-2023</description></item><item><title>go 反射简单使用(Reflect)</title><link>https://www.okrust.com/posts/golang/reflect/</link><pubDate>Thu, 25 May 2023 13:53:24 +0800</pubDate><guid>https://www.okrust.com/posts/golang/reflect/</guid><description>redbunny https://www.okrust.com/posts/golang/reflect/ -&lt;h1 id="反射">反射&lt;/h1>
&lt;blockquote>
&lt;p>介绍基本使用，具体深入点击下面的链接&lt;/p>
&lt;p>深入理解 :&lt;a href="https://draveness.me/golang/docs/part2-foundation/ch04-basic/golang-reflect/">点击跳转&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h2 id="使用反射">使用反射&lt;/h2>
&lt;p>虽然在大多数的应用和服务中并不常见，但是很多框架都依赖 Go 语言的反射机制简化代码。因为 Go 语言的语法元素很少、设计简单，所以它没有特别强的表达能力，但是 Go 语言的 reflect 包能够弥补它在语法上reflect.Type的一些劣势。&lt;/p>
&lt;p>reflect 实现了运行时的反射能力，能够让程序操作不同类型的对象。&lt;/p>
&lt;p>反射主要围绕这两个函数运行:&lt;/p>
&lt;ul>
&lt;li>reflect.TypeOf 能获取类型信息&lt;/li>
&lt;li>reflect.ValueOf 能获取数据的运行时表示&lt;/li>
&lt;/ul>
&lt;h3 id="反射reflecttypeof-reflectvalueof">反射(reflect.TypeOf reflect.ValueOf)&lt;/h3>
&lt;h4 id="获取一个变量">获取一个变量&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>strings &lt;span style="color:#ff7b72;font-weight:bold">:=&lt;/span> &lt;span style="color:#a5d6ff">123&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>t &lt;span style="color:#ff7b72;font-weight:bold">:=&lt;/span> reflect.&lt;span style="color:#d2a8ff;font-weight:bold">TypeOf&lt;/span>(strings)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>v &lt;span style="color:#ff7b72;font-weight:bold">:=&lt;/span> reflect.&lt;span style="color:#d2a8ff;font-weight:bold">ValueOf&lt;/span>(strings)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fmt.&lt;span style="color:#d2a8ff;font-weight:bold">Println&lt;/span>(t)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>fmt.&lt;span style="color:#d2a8ff;font-weight:bold">Println&lt;/span>(v)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>output: int 123&lt;/p>
&lt;p>TypeOf 主要获取变量的类型
ValueOf 主要获取变量的值&lt;/p>
&lt;h4 id="heading">&lt;/h4>
&lt;p>下面来一个结构体&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72">type&lt;/span> student &lt;span style="color:#ff7b72">struct&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> name &lt;span style="color:#ff7b72">string&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> age &lt;span style="color:#ff7b72">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72">func&lt;/span> &lt;span style="color:#d2a8ff;font-weight:bold">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> s &lt;span style="color:#ff7b72;font-weight:bold">:=&lt;/span> student{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> name: &lt;span style="color:#a5d6ff">&amp;#34;go&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> age: &lt;span style="color:#a5d6ff">16&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t &lt;span style="color:#ff7b72;font-weight:bold">:=&lt;/span> reflect.&lt;span style="color:#d2a8ff;font-weight:bold">TypeOf&lt;/span>(s)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> v &lt;span style="color:#ff7b72;font-weight:bold">:=&lt;/span> reflect.&lt;span style="color:#d2a8ff;font-weight:bold">ValueOf&lt;/span>(s)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fmt.&lt;span style="color:#d2a8ff;font-weight:bold">Println&lt;/span>(t)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fmt.&lt;span style="color:#d2a8ff;font-weight:bold">Println&lt;/span>(v)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff7b72">for&lt;/span> i &lt;span style="color:#ff7b72;font-weight:bold">:=&lt;/span> &lt;span style="color:#a5d6ff">0&lt;/span>; i &amp;lt; v.&lt;span style="color:#d2a8ff;font-weight:bold">NumField&lt;/span>(); i&lt;span style="color:#ff7b72;font-weight:bold">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fmt.&lt;span style="color:#d2a8ff;font-weight:bold">Printf&lt;/span>(&lt;span style="color:#a5d6ff">&amp;#34;type:%v,value:%v\n&amp;#34;&lt;/span>, v.&lt;span style="color:#d2a8ff;font-weight:bold">Field&lt;/span>(i).&lt;span style="color:#d2a8ff;font-weight:bold">Type&lt;/span>(), v.&lt;span style="color:#d2a8ff;font-weight:bold">Field&lt;/span>(i))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>这里用到了&lt;code>for&lt;/code> 是因为结构体里面有多个字段&lt;/p>
&lt;ol>
&lt;li>&lt;code>reflect.ValueOf(s).NumField()&lt;/code> 是获取结构体里面有多少个字段&lt;/li>
&lt;li>&lt;code>reflect.ValueOf(s).Field([index])&lt;/code> 是 &lt;code>reflect.Value&lt;/code> 一个方法，获取字段里的值&lt;/li>
&lt;/ol>
&lt;h4 id="kind--方法">Kind 方法&lt;/h4>
&lt;p>主要获取当前传入的类型&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72">func&lt;/span> &lt;span style="color:#d2a8ff;font-weight:bold">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> s &lt;span style="color:#ff7b72;font-weight:bold">:=&lt;/span> student{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> name: &lt;span style="color:#a5d6ff">&amp;#34;go&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> age: &lt;span style="color:#a5d6ff">16&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t &lt;span style="color:#ff7b72;font-weight:bold">:=&lt;/span> reflect.&lt;span style="color:#d2a8ff;font-weight:bold">TypeOf&lt;/span>(s)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> v &lt;span style="color:#ff7b72;font-weight:bold">:=&lt;/span> reflect.&lt;span style="color:#d2a8ff;font-weight:bold">ValueOf&lt;/span>(s)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fmt.&lt;span style="color:#d2a8ff;font-weight:bold">Println&lt;/span>(&lt;span style="color:#a5d6ff">&amp;#34;TypeOfKind:&amp;#34;&lt;/span>, t.&lt;span style="color:#d2a8ff;font-weight:bold">Kind&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fmt.&lt;span style="color:#d2a8ff;font-weight:bold">Println&lt;/span>(&lt;span style="color:#a5d6ff">&amp;#34;ValueOfKind:&amp;#34;&lt;/span>, v.&lt;span style="color:#d2a8ff;font-weight:bold">Kind&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> f &lt;span style="color:#ff7b72;font-weight:bold">:=&lt;/span> &lt;span style="color:#a5d6ff">3.14159&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t = reflect.&lt;span style="color:#d2a8ff;font-weight:bold">TypeOf&lt;/span>(f)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> v = reflect.&lt;span style="color:#d2a8ff;font-weight:bold">ValueOf&lt;/span>(f)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fmt.&lt;span style="color:#d2a8ff;font-weight:bold">Println&lt;/span>(&lt;span style="color:#a5d6ff">&amp;#34;TypeOfKind:&amp;#34;&lt;/span>, t.&lt;span style="color:#d2a8ff;font-weight:bold">Kind&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fmt.&lt;span style="color:#d2a8ff;font-weight:bold">Println&lt;/span>(&lt;span style="color:#a5d6ff">&amp;#34;ValueOfKind:&amp;#34;&lt;/span>, v.&lt;span style="color:#d2a8ff;font-weight:bold">Kind&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">//output:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">//TypeOfKind: struct
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">//ValueOfKind: struct
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">//TypeOfKind: float64
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">//ValueOfKind: float64
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>可以看出 结构体是 &lt;code>struct&lt;/code>,定义变量是 &lt;code>float&lt;/code>,但是结构体里面有其他的字段，每个字段 类型也不一样，也可以获取&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72">func&lt;/span> &lt;span style="color:#d2a8ff;font-weight:bold">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> s &lt;span style="color:#ff7b72;font-weight:bold">:=&lt;/span> student{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> name: &lt;span style="color:#a5d6ff">&amp;#34;go&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> age: &lt;span style="color:#a5d6ff">16&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t &lt;span style="color:#ff7b72;font-weight:bold">:=&lt;/span> reflect.&lt;span style="color:#d2a8ff;font-weight:bold">TypeOf&lt;/span>(s)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> v &lt;span style="color:#ff7b72;font-weight:bold">:=&lt;/span> reflect.&lt;span style="color:#d2a8ff;font-weight:bold">ValueOf&lt;/span>(s)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff7b72">for&lt;/span> i &lt;span style="color:#ff7b72;font-weight:bold">:=&lt;/span> &lt;span style="color:#a5d6ff">0&lt;/span>; i &amp;lt; v.&lt;span style="color:#d2a8ff;font-weight:bold">NumField&lt;/span>(); i&lt;span style="color:#ff7b72;font-weight:bold">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fmt.&lt;span style="color:#d2a8ff;font-weight:bold">Printf&lt;/span>(&lt;span style="color:#a5d6ff">&amp;#34;typeKind:%v,valueKind:%v\n&amp;#34;&lt;/span>, v.&lt;span style="color:#d2a8ff;font-weight:bold">Field&lt;/span>(i).&lt;span style="color:#d2a8ff;font-weight:bold">Type&lt;/span>().&lt;span style="color:#d2a8ff;font-weight:bold">Kind&lt;/span>(), v.&lt;span style="color:#d2a8ff;font-weight:bold">Field&lt;/span>(i).&lt;span style="color:#d2a8ff;font-weight:bold">Kind&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">//typeKind:string,valueKind:string
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">//typeKind:int,valueKind:int
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="通过反射修改值">通过反射修改值&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72">func&lt;/span> &lt;span style="color:#d2a8ff;font-weight:bold">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> f &lt;span style="color:#ff7b72;font-weight:bold">:=&lt;/span> &lt;span style="color:#a5d6ff">3.14&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> v &lt;span style="color:#ff7b72;font-weight:bold">:=&lt;/span> reflect.&lt;span style="color:#d2a8ff;font-weight:bold">ValueOf&lt;/span>(&lt;span style="color:#ff7b72;font-weight:bold">&amp;amp;&lt;/span>f)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8b949e;font-style:italic">//获取原始指针
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">&lt;/span> Uv &lt;span style="color:#ff7b72;font-weight:bold">:=&lt;/span> v.&lt;span style="color:#d2a8ff;font-weight:bold">Elem&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fmt.&lt;span style="color:#d2a8ff;font-weight:bold">Println&lt;/span>(&lt;span style="color:#a5d6ff">&amp;#34;values:&amp;#34;&lt;/span>, Uv)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8b949e;font-style:italic">//这里是float 所以设置float值
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">&lt;/span> Uv.&lt;span style="color:#d2a8ff;font-weight:bold">SetFloat&lt;/span>(&lt;span style="color:#a5d6ff">1.3456&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fmt.&lt;span style="color:#d2a8ff;font-weight:bold">Println&lt;/span>(&lt;span style="color:#a5d6ff">&amp;#34;values:&amp;#34;&lt;/span>, Uv)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">//values: 3.14
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">//values: 1.3456
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>传入的一定要是指针否则会报错，&lt;/p>
&lt;h4 id="反射实现一个sql生成器demo">反射实现一个sql生成器demo&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72">func&lt;/span> &lt;span style="color:#d2a8ff;font-weight:bold">main&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> s &lt;span style="color:#ff7b72;font-weight:bold">:=&lt;/span> student{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> name: &lt;span style="color:#a5d6ff">&amp;#34;go&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> age: &lt;span style="color:#a5d6ff">16&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fmt.&lt;span style="color:#d2a8ff;font-weight:bold">Println&lt;/span>(&lt;span style="color:#d2a8ff;font-weight:bold">QueryCreate&lt;/span>(s))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72">func&lt;/span> &lt;span style="color:#d2a8ff;font-weight:bold">QueryCreate&lt;/span>(value &lt;span style="color:#ff7b72">interface&lt;/span>{}) &lt;span style="color:#ff7b72">string&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> t &lt;span style="color:#ff7b72;font-weight:bold">:=&lt;/span> reflect.&lt;span style="color:#d2a8ff;font-weight:bold">TypeOf&lt;/span>(value)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> v &lt;span style="color:#ff7b72;font-weight:bold">:=&lt;/span> reflect.&lt;span style="color:#d2a8ff;font-weight:bold">ValueOf&lt;/span>(value)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sql &lt;span style="color:#ff7b72;font-weight:bold">:=&lt;/span> fmt.&lt;span style="color:#d2a8ff;font-weight:bold">Sprintf&lt;/span>(&lt;span style="color:#a5d6ff">&amp;#34;insert into %s&amp;#34;&lt;/span>, t.&lt;span style="color:#d2a8ff;font-weight:bold">Name&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> columns &lt;span style="color:#ff7b72;font-weight:bold">:=&lt;/span> &lt;span style="color:#a5d6ff">&amp;#34;(&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> values &lt;span style="color:#ff7b72;font-weight:bold">:=&lt;/span> &lt;span style="color:#a5d6ff">&amp;#34;values (&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff7b72">for&lt;/span> i &lt;span style="color:#ff7b72;font-weight:bold">:=&lt;/span> &lt;span style="color:#a5d6ff">0&lt;/span>; i &amp;lt; v.&lt;span style="color:#d2a8ff;font-weight:bold">NumField&lt;/span>(); i&lt;span style="color:#ff7b72;font-weight:bold">++&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff7b72">switch&lt;/span> v.&lt;span style="color:#d2a8ff;font-weight:bold">Field&lt;/span>(i).&lt;span style="color:#d2a8ff;font-weight:bold">Kind&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff7b72">case&lt;/span> reflect.Int:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff7b72">if&lt;/span> i &lt;span style="color:#ff7b72;font-weight:bold">==&lt;/span> &lt;span style="color:#a5d6ff">0&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> columns &lt;span style="color:#ff7b72;font-weight:bold">+=&lt;/span> fmt.&lt;span style="color:#d2a8ff;font-weight:bold">Sprintf&lt;/span>(&lt;span style="color:#a5d6ff">&amp;#34;%s&amp;#34;&lt;/span>, t.&lt;span style="color:#d2a8ff;font-weight:bold">Field&lt;/span>(i).Name)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> values &lt;span style="color:#ff7b72;font-weight:bold">+=&lt;/span> fmt.&lt;span style="color:#d2a8ff;font-weight:bold">Sprintf&lt;/span>(&lt;span style="color:#a5d6ff">&amp;#34;%d&amp;#34;&lt;/span>, v.&lt;span style="color:#d2a8ff;font-weight:bold">Field&lt;/span>(i).&lt;span style="color:#d2a8ff;font-weight:bold">Int&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#ff7b72">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> columns &lt;span style="color:#ff7b72;font-weight:bold">+=&lt;/span> fmt.&lt;span style="color:#d2a8ff;font-weight:bold">Sprintf&lt;/span>(&lt;span style="color:#a5d6ff">&amp;#34;, %s&amp;#34;&lt;/span>, t.&lt;span style="color:#d2a8ff;font-weight:bold">Field&lt;/span>(i).Name)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> values &lt;span style="color:#ff7b72;font-weight:bold">+=&lt;/span> fmt.&lt;span style="color:#d2a8ff;font-weight:bold">Sprintf&lt;/span>(&lt;span style="color:#a5d6ff">&amp;#34;, %d&amp;#34;&lt;/span>, v.&lt;span style="color:#d2a8ff;font-weight:bold">Field&lt;/span>(i).&lt;span style="color:#d2a8ff;font-weight:bold">Int&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff7b72">case&lt;/span> reflect.String:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff7b72">if&lt;/span> i &lt;span style="color:#ff7b72;font-weight:bold">==&lt;/span> &lt;span style="color:#a5d6ff">0&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> columns &lt;span style="color:#ff7b72;font-weight:bold">+=&lt;/span> fmt.&lt;span style="color:#d2a8ff;font-weight:bold">Sprintf&lt;/span>(&lt;span style="color:#a5d6ff">&amp;#34;%s&amp;#34;&lt;/span>, t.&lt;span style="color:#d2a8ff;font-weight:bold">Field&lt;/span>(i).Name)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> values &lt;span style="color:#ff7b72;font-weight:bold">+=&lt;/span> fmt.&lt;span style="color:#d2a8ff;font-weight:bold">Sprintf&lt;/span>(&lt;span style="color:#a5d6ff">&amp;#34;&amp;#39;%s&amp;#39;&amp;#34;&lt;/span>, v.&lt;span style="color:#d2a8ff;font-weight:bold">Field&lt;/span>(i).&lt;span style="color:#d2a8ff;font-weight:bold">String&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#ff7b72">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> columns &lt;span style="color:#ff7b72;font-weight:bold">+=&lt;/span> fmt.&lt;span style="color:#d2a8ff;font-weight:bold">Sprintf&lt;/span>(&lt;span style="color:#a5d6ff">&amp;#34;, %s&amp;#34;&lt;/span>, t.&lt;span style="color:#d2a8ff;font-weight:bold">Field&lt;/span>(i).Name)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> values &lt;span style="color:#ff7b72;font-weight:bold">+=&lt;/span> fmt.&lt;span style="color:#d2a8ff;font-weight:bold">Sprintf&lt;/span>(&lt;span style="color:#a5d6ff">&amp;#34;, &amp;#39;%s&amp;#39;&amp;#34;&lt;/span>, v.&lt;span style="color:#d2a8ff;font-weight:bold">Field&lt;/span>(i).&lt;span style="color:#d2a8ff;font-weight:bold">String&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> columns &lt;span style="color:#ff7b72;font-weight:bold">+=&lt;/span> &lt;span style="color:#a5d6ff">&amp;#34;); &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> values &lt;span style="color:#ff7b72;font-weight:bold">+=&lt;/span> &lt;span style="color:#a5d6ff">&amp;#34;); &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sql &lt;span style="color:#ff7b72;font-weight:bold">+=&lt;/span> columns &lt;span style="color:#ff7b72;font-weight:bold">+&lt;/span> values
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff7b72">return&lt;/span> sql
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">//output: insert into student(name, age); values (&amp;#39;go&amp;#39;, 16);
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>- https://www.okrust.com/posts/golang/reflect/ - 2022-2023</description></item><item><title>Kubenets in Action cli</title><link>https://www.okrust.com/posts/kubenets-in-action/</link><pubDate>Fri, 05 May 2023 16:33:24 +0800</pubDate><guid>https://www.okrust.com/posts/kubenets-in-action/</guid><description>redbunny https://www.okrust.com/posts/kubenets-in-action/ -&lt;h1 id="常用指令">常用指令&lt;/h1>
&lt;blockquote>
&lt;p>学习中文档不全,慢慢整理&amp;hellip;..&lt;/p>
&lt;p>所有资源来自 kubernets in action，只折抄个人需要的&lt;/p>
&lt;/blockquote>
&lt;h2 id="2开始使用kubernets-和docker">2.开始使用kubernets 和docker&lt;/h2>
&lt;h3 id="1-创建运行及共享容器镜像">1. 创建、运行及共享容器镜像&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>docker build -t kubia .
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="3-运行第一个程序">3. 运行第一个程序&lt;/h3>
&lt;h4 id="2访问第web-应用">2.访问第web 应用&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl expose rc kubia --type&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>LoadBalancer --name kubia-http
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>我们这里用的是replicationtroller的缩写rc。大 多数资源类型都有这样的缩写，所以不必输入全名（例如，pods的缩写是po,service的缩写是SVC，等等）列出服务&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl get service
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl get svc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>水平伸缩应用&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl get replicationcontrollers
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAME DESIRED CURRENT READY AGE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubia &lt;span style="color:#a5d6ff">1&lt;/span> &lt;span style="color:#a5d6ff">1&lt;/span> &lt;span style="color:#a5d6ff">1&lt;/span> 32m
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>DESIRED 副本数量 ,CURRENT 希望运行的pod数量&lt;/p>
&lt;/blockquote>
&lt;p>增加副本数量&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl scale rc kubia --replicas&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>&lt;span style="color:#a5d6ff">3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAME DESIRED CURRENT READY AGE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubia &lt;span style="color:#a5d6ff">3&lt;/span> &lt;span style="color:#a5d6ff">3&lt;/span> &lt;span style="color:#a5d6ff">1&lt;/span> 34m
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>如过有多个副本，则会均衡负载&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>root@master:/home/ubuntu/kubernetes-in-action-v1-notes/Chapter02# kubectl get po
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubia-chlfj 1/1 Running &lt;span style="color:#a5d6ff">0&lt;/span> 2m19s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubia-lrql6 1/1 Running &lt;span style="color:#a5d6ff">0&lt;/span> 36m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubia-qk7mv 1/1 Running &lt;span style="color:#a5d6ff">0&lt;/span> 2m19s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>root@master:/home/ubuntu/kubernetes-in-action-v1-notes/Chapter02# kubectl get service
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span style="color:#ff7b72;font-weight:bold">(&lt;/span>S&lt;span style="color:#ff7b72;font-weight:bold">)&lt;/span> AGE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubernetes ClusterIP 10.96.0.1 &amp;lt;none&amp;gt; 443/TCP 56m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubia-http LoadBalancer 10.104.229.236 &amp;lt;pending&amp;gt; 8080:31338/TCP 11m
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>root@master:/home/ubuntu/kubernetes-in-action-v1-notes/Chapter02# curl 10.104.229.236:8080
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>You&lt;span style="color:#a5d6ff">&amp;#39;ve hit kubia-lrql6
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a5d6ff">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a5d6ff">root@master:/home/ubuntu/kubernetes-in-action-v1-notes/Chapter02# curl 10.104.229.236:8080
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a5d6ff">You&amp;#39;&lt;/span>ve hit kubia-qk7mv
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>root@master:/home/ubuntu/kubernetes-in-action-v1-notes/Chapter02# curl 10.104.229.236:8080
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>You&lt;span style="color:#a5d6ff">&amp;#39;ve hit kubia-qk7mv
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a5d6ff">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a5d6ff">root@master:/home/ubuntu/kubernetes-in-action-v1-notes/Chapter02# curl 10.104.229.236:8080
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a5d6ff">You&amp;#39;&lt;/span>ve hit kubia-lrql6
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>root@master:/home/ubuntu/kubernetes-in-action-v1-notes/Chapter02# curl 10.104.229.236:8080
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>You&lt;span style="color:#a5d6ff">&amp;#39;ve hit kubia-qk7mv
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a5d6ff">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a5d6ff">root@master:/home/ubuntu/kubernetes-in-action-v1-notes/Chapter02# curl 10.104.229.236:8080
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a5d6ff">You&amp;#39;&lt;/span>ve hit kubia-qk7mv
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>oot@master:/home/ubuntu/kubernetes-in-action-v1-notes/Chapter02# curl 10.104.229.236:8080
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>You&lt;span style="color:#f85149">&amp;#39;&lt;/span>ve hit kubia-chlfj
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>列出 pod 时显示 pod IP 和 pod 的节点&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl get pods -o wide
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubia-chlfj 1/1 Running &lt;span style="color:#a5d6ff">0&lt;/span> 8m49s 10.40.0.2 node2 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubia-lrql6 1/1 Running &lt;span style="color:#a5d6ff">0&lt;/span> 42m 10.40.0.1 node2 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubia-qk7mv 1/1 Running &lt;span style="color:#a5d6ff">0&lt;/span> 8m49s 10.38.0.1 node1 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>查看pod详细信息&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl describe pod kubia-chlfj
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Name: kubia-chlfj
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Namespace: default
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Priority: &lt;span style="color:#a5d6ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Node: node2/192.168.0.201
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Start Time: Fri, &lt;span style="color:#a5d6ff">05&lt;/span> May &lt;span style="color:#a5d6ff">2023&lt;/span> 09:04:47 +0000
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Labels: &lt;span style="color:#79c0ff">run&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>kubia
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Annotations: &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Status: Running
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>IP: 10.40.0.2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>IPs:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> IP: 10.40.0.2
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Controlled By: ReplicationController/kubia
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>访问GKE集群dashbord&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl cluster-info | grep dashboard
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>如果你正在使 用 Google Kubemetes Engine&lt;/p>
&lt;/blockquote>
&lt;h2 id="3运行于kuberntes-中的容器">3.运行于Kuberntes 中的容器&lt;/h2>
&lt;h2 id="32-以yaml或者json文件创建pod">3.2 以YAML或者JSON文件创建pod&lt;/h2>
&lt;h4 id="321-检查现有的yaml描述">3.2.1 检查现有的yaml描述&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl get po kubia-zxzij -o yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://www.okrust.com/kubernet-in-action/2023-03-29_14-37.png" alt="yaml">
&lt;img src="https://www.okrust.com/kubernet-in-action/2023-05-05_17-41.png" alt="yaml">&lt;/p>
&lt;ul>
&lt;li>metadata包括名称、命名空间、标 签和关于该容器 的其他信息。&lt;/li>
&lt;li>spec包含p od内容的实际说明，例如p od的容器、卷和其他数据。&lt;/li>
&lt;li>status包含运行中的pod的当前信息，例如po d所处的条件、每个容器的描述和状态，以及内部IP和其他基本信息&lt;/li>
&lt;/ul>
&lt;p>使用 kubectl explain 来发现可能的 API 对象字段&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#在准备 manifest 时，可以转到 http: //kubemetes.io / docs /api 上的 Kubemetes参考文档查看每个 API 对象支持哪些属性，也可以使用 kubectl explain 命令 。例如，当从头创建一个 pod manifest 时，可以从请求 kubectl 来解释 pod 开始：&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl explain pods
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl explain pod.spec
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="323-kubectl-create-创建pod">3.2.3 kubectl create 创建pod&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl create -f kubia-manual.yam
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>得到pod完整定义&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl get po kubia-manual -o yaml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl get po kubia-manual -o json
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>查看新建的pod&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl get pods
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="324-查看应用程序日志">3.2.4 查看应用程序日志&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl logs kubia-manual
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>如果包含多个pod 的日志时指定容器名称&lt;/p>
&lt;p>如果我们的pod包含多个容器， 在运行kubectl logs命令时则必须通过包含-c &amp;lt;容器名称＞选项来显式指定容器名称。 在kubia-manual pod中， 我们将容器的名称设置为kubia, 所以如果该pod中有其他容器， 可以通过如下命令获取其日志&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl logs kubia-manual -c kubia
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="325-向pod发送请求">3.2.5 向pod发送请求&lt;/h4>
&lt;p>将本地网络端口转发到 pod 中的端口&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl port-forward kubia-manual 8888:8080
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="33-使用标签组织pod">3.3 使用标签组织pod&lt;/h3>
&lt;h4 id="332-创建pod标签labels">3.3.2 创建pod标签labels&lt;/h4>
&lt;p>创建pod&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl create -f kubia-manual-with-labels.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>查看标签&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl get po --show-labels
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>查看指定的标签 labels,然后分组出来&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl get po -L creation_method,env
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://www.okrust.com/kubernet-in-action/3.3.2/2023-05-06_17-08.png" alt="img">&lt;/p>
&lt;h4 id="333-修改添加pod-标签-labels">3.3.3 修改添加pod 标签 labels&lt;/h4>
&lt;p>新增标签&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl label po kubia-manual &lt;span style="color:#79c0ff">creation_method&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>manual
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#pod/kubia-manual labeled&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>标签也可以在现有 pod 上进行添加和修改。 由于 pod kubia -manual 也是手动创建的， 所以为其添加 creation_method=manual 标签：&lt;/p>
&lt;/blockquote>
&lt;p>修改标签&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl label po kubia-manual-v2 &lt;span style="color:#79c0ff">env&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>debug --overwrite
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>修改现有的标签需要添加 &amp;ndash;overwrite&lt;/p>
&lt;/blockquote>
&lt;p>&lt;img src="https://www.okrust.com/kubernet-in-action/3.3.3/2023-05-06_17-20.png" alt="img">&lt;/p>
&lt;h3 id="34-通过标签选择器列出pod子集">3.4 通过标签选择器列出pod子集&lt;/h3>
&lt;h4 id="341-使用标签选择器列出pod">3.4.1 使用标签选择器列出pod&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl get po -L &lt;span style="color:#79c0ff">creation_method&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>manua
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>查询不包括&lt;code>env&lt;/code>的pod&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl get po -l &lt;span style="color:#a5d6ff">&amp;#39;!env&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>查询不包括&lt;code>env&lt;/code>的pod&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl get po -l &lt;span style="color:#a5d6ff">&amp;#39;env&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>加入 &amp;ndash;show-labels 显示lables信息&lt;/p>
&lt;/blockquote>
&lt;p>多种查询条件&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl get po -l &lt;span style="color:#a5d6ff">&amp;#39;run=kubia&amp;#39;&lt;/span> --show-labels
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl get po -l &lt;span style="color:#a5d6ff">&amp;#39;run!=kubia&amp;#39;&lt;/span> --show-labels
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://www.okrust.com/kubernet-in-action/3.4.1/2023-05-06_17-42.png" alt="img">&lt;/p>
&lt;h4 id="342-在标签选择器中使用多个条件">3.4.2 在标签选择器中使用多个条件&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl get po -l &lt;span style="color:#a5d6ff">&amp;#39;creation_method=manual,method=manual&amp;#39;&lt;/span> --show-labels
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl get po -l &lt;span style="color:#a5d6ff">&amp;#39;creation_method=manual,method!=manual&amp;#39;&lt;/span> --show-labels
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://www.okrust.com/kubernet-in-action/3.4.2/2023-05-06_17-45.png" alt="img">&lt;/p>
&lt;h3 id="35-使用标签和选择器来约束pod调度">3.5 使用标签和选择器来约束pod调度&lt;/h3>
&lt;h4 id="351-使用标签分类工作节点">3.5.1 使用标签分类工作节点&lt;/h4>
&lt;p>假如node1 是SSD,node2 是hdd，某些环境需要ssd，可以通过labels 置顶调度到某个节点&lt;/p>
&lt;p>假设我们集群中的 一个节点刚添加完成， 它包含一个用于通用GPU计算的GPU。 我们希望向节点添加标签来展示这个功能特性， 可以通过将 标签gpu=true添加到其中一个节点来实现（只需从kubectl get nodes返回的列表中选择一
个）：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl label node node1 &lt;span style="color:#79c0ff">gpu&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>true
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://www.okrust.com/kubernet-in-action/3.5.1/2023-05-06_18-00.png" alt="img">&lt;/p>
&lt;p>查询拥有gpu labels的node&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl get node -l gpu
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="352-将pod调度到特定节点">3.5.2 将pod调度到特定节点&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>apiVersion: v1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kind: Pod
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>metadata:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> name: kubia-gpu
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>spec:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> nodeSelector:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> gpu: &lt;span style="color:#a5d6ff">&amp;#34;true&amp;#34;&lt;/span> &lt;span style="color:#8b949e;font-style:italic">#node节点有gput=true的，则会调度到这个节点&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> containers:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - image: luksa/kubia
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> name: kubia
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="36-注解pod">3.6 注解pod&lt;/h3>
&lt;h4 id="361-查找对象的注解">3.6.1 查找对象的注解&lt;/h4>
&lt;p>&lt;img src="https://www.okrust.com/kubernet-in-action/3.6.1/2023-05-06_18-10.png" alt="img">&lt;/p>
&lt;h4 id="362-添加和修改注解">3.6.2 添加和修改注解&lt;/h4>
&lt;p>给 &lt;code>kubia-manual&lt;/code> pod添加注解&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl annotate pod kubia-manual mycompany.com/someannotation&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>&lt;span style="color:#a5d6ff">&amp;#34;foo bar&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>查看注解&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl describe pod kubia-manual
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#注解信息&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Annotations: mycompany.com/someannotation: foo bar
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://www.okrust.com/kubernet-in-action/3.6.2/2023-05-06_18-15.png" alt="img">&lt;/p>
&lt;h3 id="37-使用命名空间对资源进行分组">3.7 使用命名空间对资源进行分组&lt;/h3>
&lt;h4 id="372-发现其他命名空间及其-pod">3.7.2 发现其他命名空间及其 pod&lt;/h4>
&lt;p>查看所有命名空间&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl get ns
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>查看指定的命名空间pod,&lt;code>kube-system&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl get po --namespace kube-system
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl get po -n kube-system
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="373-创建一个命名空间">3.7.3 创建一个命名空间&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>apiVersion: v1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kind: Namespace &lt;span style="color:#8b949e;font-style:italic">#定义命名空间&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>metadata:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> name: custom-namespace &lt;span style="color:#8b949e;font-style:italic"># 命名空间名称&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>直接创建&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl create -f custom-namespace.yaml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#手动创建命名空间&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl create namespace custom-namespace
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>查看所有命名空间&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl get namespace
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAME STATUS AGE
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>custom-namespace Active 57s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>default Active 4d
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kube-node-lease Active 4d
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kube-public Active 4d
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kube-system Active 4d
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="374-管理其他命名空间中的对象">3.7.4 管理其他命名空间中的对象&lt;/h4>
&lt;p>在创建资源的时候，如果yaml文件没指定，可以在创建时候指定&lt;code>命名空间&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl create -f kubia-manual.yam1 -n custom-namespace
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>切换命名空间&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#获取所有&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl get namespace
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl config set-context --current --namespace&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>&amp;lt;namespace&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl config set-context --current --namespace&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>custom-namespace
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#指定操作命名空间&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl get pods -n &amp;lt;namespace&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="38-停止和移除-pod">3.8 停止和移除 pod&lt;/h3>
&lt;h4 id="381-按名称删除-pod">3.8.1 按名称删除 pod&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl delete po kubia-gpu
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#删除多个po &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl delete po podl pod2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="382-使用标签选择器删除-pod">3.8.2 使用标签选择器删除 pod&lt;/h4>
&lt;p>删除带 &lt;code>creation_method=manua&lt;/code> 的labels的pod&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl delete po -l &lt;span style="color:#79c0ff">creation_method&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#pod &amp;#34;kubia-manual&amp;#34; deleted&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#pod &amp;#34;kubia-manual-v2&amp;#34; deleted&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="383-通过删除整个命名空间来删除-pod">3.8.3 通过删除整个命名空间来删除 pod&lt;/h4>
&lt;p>命名空间不需要的可以直接删除，同时删除里面的pod&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl delete ns custom-namespace
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="384-删除命名空间中的所有pod但保留命名空间">3.8.4 删除命名空间中的所有pod，但保留命名空间&lt;/h4>
&lt;p>删除所有的pod&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl delete po --all
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>再次查看会发现 之前的pod又重启回来,是因为&lt;code>ReplicationController&lt;/code>，杀死之后会启动与之相同的pod，得得先删除 &lt;code>ReplicationController&lt;/code>&lt;/p>
&lt;h4 id="385-删除命名空间中的几乎所有资源">3.8.5 删除命名空间中的（几乎）所有资源&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl delete all --all
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pod &lt;span style="color:#a5d6ff">&amp;#34;kubia-fvn4n&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pod &lt;span style="color:#a5d6ff">&amp;#34;kubia-lnwdg&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pod &lt;span style="color:#a5d6ff">&amp;#34;kubia-tgnlk&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>replicationcontroller &lt;span style="color:#a5d6ff">&amp;#34;kubia&amp;#34;&lt;/span> deleted &lt;span style="color:#8b949e;font-style:italic">#删除了 ReplicationController 所有的资源被删除&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service &lt;span style="color:#a5d6ff">&amp;#34;kubernetes&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>service &lt;span style="color:#a5d6ff">&amp;#34;kubia-http&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>命令中的第 一个 all 指定正在删除所有资源类型， 而 &amp;ndash;all 选项指定将删除所有资源实例而不是按名称指定它们（我们在运行前一个删除命令时已经使用过此选项）。&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>注意 kubectl delete all &amp;ndash;all 命令也会删除名为 kubernetes 的Service, 但它应该会在几分钟后自动重新创建。&lt;/p>
&lt;/blockquote>
&lt;h3 id="39-本章小结">3.9 本章小结&lt;/h3>
&lt;p>阅读本章之后， 你应该对 Kubemetes 的核心模块有了系统的了解。 在接下来的
几章中学到的概念也都与 pod 有着直接关联。&lt;/p>
&lt;p>在本章中， 你应该已经掌握：&lt;/p>
&lt;ul>
&lt;li>如何决定是否应将某些容器组合在一个 pod 中。&lt;/li>
&lt;li>pod可以运行多个进程， 这和非容器世界中的物理主机类似。&lt;/li>
&lt;li>可以编写 YAML 或 JSON 描述文件用于创建 pod, 然后查看 pod 的规格及其
当前状态。&lt;/li>
&lt;li>使用标签来组织 pod, 并且一 次在多个 pod 上执行操作。&lt;/li>
&lt;li>可以使用节点标签将 pod 只调度到提供某些指定特性的节点上。&lt;/li>
&lt;li>注解允许入们、 工具或库将更大的数据块附加到 pod。&lt;/li>
&lt;li>命名空间可用千允 许不同团队使 用同 一 集 群， 就像它 们使 用单独的
Kubemetes 集群一 样。&lt;/li>
&lt;li>使用 kubectl explain 命令快速查看任何 Kubernetes 资源的信息。
在下一章， 你将会了解到 ReplicationController 和其他管理 pod 的资源。&lt;/li>
&lt;/ul>
&lt;h2 id="4-副本机制和其他控制器部署托管的pod">4. 副本机制和其他控制器:部署托管的pod&lt;/h2>
&lt;h3 id="41-保持pod健康">4.1 保持pod健康&lt;/h3>
&lt;ul>
&lt;li>使用 Kubernetes 的一 个主要好处是， 可以给 Kubernetes 一个容器列表来由其 保
持容器在集群中的运行。 可以通过让 Kubernetes 创建 pod 资源， 为其选择 一 个工作
节点并在该节点上运行该 pod 的容器来完成此操作。 但是， 如果其中一个容器终止，
或一 个 pod 的所有容器都终止， 怎么办？&lt;/li>
&lt;li>只要将 pod 调度到某个节点， 该节点上的 Kubelet 就会运行 pod 的容器， 从此
只要该 pod 存在， 就会保持运行。 如果容器的主进程崩溃， Kubelet 将重启容器。 如
果应用程序中有一 个导致它每隔 一 段时间就会崩溃的 bug, Kubemetes 会自动重启
应用程序， 所以即使应用程序本身没有做任何特殊的事， 在 Kubemetes 中运行也能
自动获得自我修复的能力。&lt;/li>
&lt;li>即使进程没有崩溃， 有时应用程序也会停止正常工作。 例如， 具有内存泄漏的
Java 应用程序将开始抛出 OutOfMemoryErrors, 但 JVM 进程会一 直运行。 如果有
一种方法， 能让应用程序向 Kubernetes 发出信号， 告诉 Kubemetes 它运行异常并让
Kubemetes 重新启动， 那就很棒了。&lt;/li>
&lt;li>我们已经说过， 一 个崩溃的容器会自动重启， 所以也许你会想到， 可以在应用
中捕获这类错误， 并在错误发生时退出该进程。 当然可以这样做， 但这仍然不能解
决所有的问题。&lt;/li>
&lt;li>例如， 你的应用因为无限循环或死锁而停止响应。 为确保应用程序在这种情况
下可以重新启动， 必须从外部检查应用程序的运行状况， 而不是依赖于应用的内部
检测。&lt;/li>
&lt;/ul>
&lt;h4 id="411-介绍存活探针">4.1.1 介绍存活探针&lt;/h4>
&lt;p>Kubemetes 有以下三种探测容器的机制：&lt;/p>
&lt;ul>
&lt;li>HTTPGET 探针对容器的 IP 地址（你指定的端口和路径）执行 HTTP GET 请求。
如果探测器收到响应，并且响应状态码不代表错误（换句话说，如果HTTP
响应状态码是2xx或3xx), 则认为探测成功。如果服务器返回错误响应状态
码或者根本没有响应，那么探测就被认为是失败的，容器将被重新启动。&lt;/li>
&lt;li>TCP套接字探针尝试与容器指定端口建立TCP连接。如果连接成功建立，则
探测成功。否则，容器重新启动。&lt;/li>
&lt;li>Exec探针在容器内执行任意命令，并检查命令的退出状态码。如果状态码
是 o, 则探测成功。所有其他状态码都被认为失败。&lt;/li>
&lt;/ul>
&lt;h4 id="412-创建基于http的存活探针">4.1.2 创建基于HTTP的存活探针&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yml" data-lang="yml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7ee787">apiVersion&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">v1&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681">&lt;/span>&lt;span style="color:#7ee787">kind&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">Pod&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681">&lt;/span>&lt;span style="color:#7ee787">metadata&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">name&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">kubia-liveness&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681">&lt;/span>&lt;span style="color:#7ee787">spec&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">containers&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>- &lt;span style="color:#7ee787">image&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">luksa/kubia-unhealthy&lt;/span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#8b949e;font-style:italic">#的含么包怎用像知应镜不的^_（掉这了坏&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">name&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">kubia&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">livenessProbe&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#8b949e;font-style:italic"># http get 探针&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">httpGet&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">path&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">/&lt;/span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#8b949e;font-style:italic">#请求路径&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">port&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">8080&lt;/span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#8b949e;font-style:italic">#端口&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="413-使用存活探针">4.1.3 使用存活探针&lt;/h4>
&lt;p>4.1.2 使用之后pod 报错会重启&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl get po kubia-liveness
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>查看log日志&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#查看当前容器&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl logs mypod
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#查看上个容器为啥报错&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl logs mypod --previous
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#-----&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Kubia server starting...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Received request from ::ffff:10.40.0.0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Received request from ::ffff:10.40.0.0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Received request from ::ffff:10.40.0.0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Received request from ::ffff:10.40.0.0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Received request from ::ffff:10.40.0.0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Received request from ::ffff:10.40.0.0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Received request from ::ffff:10.40.0.0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Received request from ::ffff:10.40.0.0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="414-配置存活探针的附加属性">4.1.4 配置存活探针的附加属性&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl get po kubia-liveness
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Liveness: http-get http://:8080/ &lt;span style="color:#79c0ff">delay&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>0s &lt;span style="color:#79c0ff">timeout&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>1s &lt;span style="color:#79c0ff">period&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>10s &lt;span style="color:#8b949e;font-style:italic">#success=1 #failure=3&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>delay(延迟）、巨meout(超时）、period(周期）等。delay=Os部分显示在容器启动后立即开始探测。tmeout仅设置为1秒，因此容器必须在1秒内进行响应， 不然这次探测记作失败。每10秒探测一次容器(period=lOs), 并在探测连续三次失败(#falure= 3)后重启容器&lt;/p>
&lt;p>添加自定义参数 &lt;code>initalDelaySeconds&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yml" data-lang="yml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7ee787">apiVersion&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">v1&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681">&lt;/span>&lt;span style="color:#7ee787">kind&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">Pod&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681">&lt;/span>&lt;span style="color:#7ee787">metadata&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">name&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">kubia-liveness&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681">&lt;/span>&lt;span style="color:#7ee787">spec&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">containers&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>- &lt;span style="color:#7ee787">image&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">luksa/kubia-unhealthy&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">name&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">kubia&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">livenessProbe&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">httpGet&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">path&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">/&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">port&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">8080&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">initialDelaySeconds&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">15&lt;/span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#8b949e;font-style:italic">#Kubernetes会在第—次探测前等待15秒&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>提示务必记得设置一个初始延迟未说明应用程序的启动时间。如果程序启动过久则会重新启动容易，陷入循环&lt;/p>
&lt;/blockquote>
&lt;p>很多场合都会看到这种情况， 用户很困惑为什么他们的容器正在重启。 但是如果使用kubectl describe, 他们会看到容器以退出码137或143结束， 并告诉他们 该pod是被迫终止的。 此外，pod事件的列表将显示容器因liveness探测失败而被终止。 如果你在pod启动时 看到这种情况， 那是因为未能适当设置
initialDelaySeconds。&lt;/p>
&lt;blockquote>
&lt;p>注意退出代码137表示进程被外部信号终止， 退出代码为128+9 (SIGKILL)。
同样， 退出代码143对应于128+15 (SIGTERM)。&lt;/p>
&lt;/blockquote>
&lt;h4 id="415-创建有效的存活探针">4.1.5 创建有效的存活探针&lt;/h4>
&lt;p>对于生产环境中一定要有个存活探针&lt;/p>
&lt;ol>
&lt;li>存活探针应该检查什么
检查服务是否响应。未响应则重启容器,一般配置特定的url &lt;code>/health HTTP&lt;/code>
&lt;blockquote>
&lt;p>提示请确保/health HTTP瑞点不需要认证， 否则探剧会一直失败， 导致你的容器无限重启。&lt;/p>
&lt;/blockquote>
&lt;/li>
&lt;li>保持探针轻量
探针只需要知道服务的是否正常运行，不占用大量资源，重量化会影响你的容器运行
&lt;blockquote>
&lt;p>如果你在容器中运行Java应用程序， 请确保使用HTTP GET存活探针，而不是启动全新NM以荻取存活信息的Exec探针。 任何基于NM或类似的应用程序也是如此， 它们的启动过程需要大量的计算资原。&lt;/p>
&lt;/blockquote>
&lt;/li>
&lt;li>无须在探针中实现重试循环
探针失败阈值是可以设置的，你设置为1，但是kubernets 会自动尝试请求多次。因此 在探针中自己实现重试循环是浪费精力。&lt;/li>
&lt;/ol>
&lt;p>存活探针小结&lt;/p>
&lt;ul>
&lt;li>你现在知道Kubernetes会在你的容器崩溃或其存活探针失败时， 通过重启容器
来保持运行。 这项任务由承载pod的节点上的Kubelet 执行 一— 在主服务器上运行
的KubernetesControl Plane组件不 会参与此 过程。&lt;/li>
&lt;li>但如果节点本身崩溃， 那么Control Plane 必须为所有随节点停止运行的pod创
建替代品。 它不 会为你直接创建的pod执行此操作 。 这些pod只被Kubelet 管理，
但由于Kubelet 本身运行在节点上， 所以如果节点异常终止，它将无法执行任何操作。&lt;/li>
&lt;li>为 了 确保你 的应 用 程序在另 一 个 节 点 上 重新启动， 需要使 用
Rep巨ca巨onController或类似机制管理pod, 我们将在本章其余部分讨论该
机制。&lt;/li>
&lt;/ul>
&lt;h3 id="42-了解replicationcontroller">4.2 了解ReplicationController&lt;/h3>
&lt;p>ReplicationController是一 种Kubemetes资源，可确保它的pod始终保持运行状态。
如果pod因任何原因 消失（例如节点从集群中消失或由于该pod已从节点中逐出），
则ReplicationController 会注意到缺少了pod并创建替代pod。&lt;/p>
&lt;h4 id="421-replicationcontroller的操作">4.2.1 ReplicationController的操作&lt;/h4>
&lt;p>ReplicationController会持续监控正在运行的pod列表， 并保证相应 ” 类型” 的
pod的数目与期望相符。 如正在运行的pod太少， 它会根据pod模板创建新的副本。
如正在运行的pod太多， 它将删除多余的副本。 你可能会对有多余的副本感到奇怪。
这可能有几个原因：&lt;/p>
&lt;ul>
&lt;li>有人会手动创建相同类型的pod。&lt;/li>
&lt;li>有人更改现有的pod的 ” 类型” 。&lt;/li>
&lt;li>有人减少了所需的pod的数量， 等等。&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.okrust.com/kubernet-in-action/2023-05-10_15-52_4.2.1.png" alt="img">&lt;/p>
&lt;h5 id="了解replicationcontroller的三部分">了解ReplicationController的三部分&lt;/h5>
&lt;p>一个ReplicationController有三个主要部分（如图4.3所示）：&lt;/p>
&lt;ul>
&lt;li>label selector ( 标签选择器）， 用于确定ReplicationController作用域中有哪些
pod&lt;/li>
&lt;li>replica count (副本个数）， 指定应运行的pod 数量&lt;/li>
&lt;li>pod template (pod模板）， 用于创建新的pod 副本&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.okrust.com/kubernet-in-action/2023-05-10_15-55_4.2.1-2.png" alt="img">&lt;/p>
&lt;h4 id="422-创建一-个-replicationcontroller">4.2.2 创建一 个 ReplicationController&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yml" data-lang="yml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7ee787">apiVersion&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">v1&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681">&lt;/span>&lt;span style="color:#7ee787">kind&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">ReplicationController&lt;/span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#8b949e;font-style:italic">#配置 ReplicationController(RC)&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681">&lt;/span>&lt;span style="color:#7ee787">metadata&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">name&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">kubia&lt;/span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#8b949e;font-style:italic">#配置 ReplicationController 名字&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681">&lt;/span>&lt;span style="color:#7ee787">spec&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">replicas&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">3&lt;/span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#8b949e;font-style:italic">#配置 pod 实例的数量 &lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">selector&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#8b949e;font-style:italic">#pod 决定的RC 操作对象&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">app&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">kubia&lt;/span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#8b949e;font-style:italic">#pod&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">template&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#8b949e;font-style:italic">#创建新的pod 所用的pod模板&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">metadata&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">labels&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">app&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">kubia&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">spec&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">containers&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>- &lt;span style="color:#7ee787">name&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">kubia&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">image&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">luksa/kubia&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">ports&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>- &lt;span style="color:#7ee787">containerPort&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">8080&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>新建时，会创建名kubia的新ReplicationControl，确保 app=kubia的pod始终为三个。pod不够会根据模板创建。并且pod 标签要与RC选择器匹配。不然会永无止境的创建。新启动的不会使实际的副本数量接近期望的副本数量。为了防止出现这种情况，API服务会校验ReplicationController的定义，不会接收错误配置。&lt;/p>
&lt;blockquote>
&lt;p>提示定义ReplicationController时不要指定pod选择器，让Kubemetes从pod模板中提取它。这样YAML更简短。&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl create -f kubia-rc.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="423-使用replicationcontroller">4.2.3 使用ReplicationController&lt;/h4>
&lt;p>查看pod&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubect get pods
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>查看 ReplicationController 对已删除的 pod 的响应&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubect delete pod kubia-53thy
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>获取有关 ReplicationController 的信息&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl get rc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>注意使用re作为replicationcontroller的简写。&lt;/p>
&lt;/blockquote>
&lt;p>查看rc详细信息&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubect describe get rc
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Name: kubia
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Namespace: default
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Selector: &lt;span style="color:#79c0ff">app&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>kubia
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Labels: &lt;span style="color:#79c0ff">app&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>kubia
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Annotations: &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Replicas: &lt;span style="color:#a5d6ff">3&lt;/span> current / &lt;span style="color:#a5d6ff">3&lt;/span> desired &lt;span style="color:#8b949e;font-style:italic"># pod 实际数量和目标数量 &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Pods Status: &lt;span style="color:#a5d6ff">3&lt;/span> Running / &lt;span style="color:#a5d6ff">0&lt;/span> Waiting / &lt;span style="color:#a5d6ff">0&lt;/span> Succeeded / &lt;span style="color:#a5d6ff">0&lt;/span> Failed &lt;span style="color:#8b949e;font-style:italic">#每种状态的pod数量 &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Pod Template:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Labels: &lt;span style="color:#79c0ff">app&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>kubia
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Containers:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> kubia:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Image: luksa/kubia
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Port: 8080/TCP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Host Port: 0/TCP
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Environment: &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Mounts: &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Volumes: &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Events: &lt;span style="color:#8b949e;font-style:italic">#和这个有关的RC 事件 &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Type Reason Age From Message
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ---- ------ ---- ---- -------
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Normal SuccessfulCreate 32m replication-controller Created pod: kubia-wqc7x
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Normal SuccessfulCreate 32m replication-controller Created pod: kubia-hxgzj
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Normal SuccessfulCreate 32m replication-controller Created pod: kubia-hv7px
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Normal SuccessfulCreate 5m11s replication-controller Created pod: kubia-8z4mz
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Normal SuccessfulCreate 3m1s replication-controller Created pod: kubia-jfslp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="424-将-pod-移入或移出-replicationcontroller-的作用域">4.2.4 将 pod 移入或移出 ReplicationController 的作用域&lt;/h4>
&lt;p>由ReplicationController创建的pod并不是绑定到ReplicationController。是由标签选择器匹配。如果我们更改pod的标签不与相匹配。可以从RC作用域中删除添加。也可以转移到其他的ReplicationController。&lt;/p>
&lt;p>如果更改了pod的标签，不匹配。异常不会被重新调度，成为手动创建的一样。更改之后旧的ReplicationController 会调度新的保持。&lt;/p>
&lt;blockquote>
&lt;p>尽管一个pod没有绑定到一个ReplicationController，但该pod在rnetadata.ownerReferences字段中引用它，可以轻松使用它来找 到一个pod属于哪个ReplicationController&lt;/p>
&lt;/blockquote>
&lt;p>给ReplicationController管理的pod加标签&lt;/p>
&lt;ol>
&lt;li>
&lt;p>你向reaplcationController 管理的pod添加其他标签，没有任何影响&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl label pod kubia-jlm79 &lt;span style="color:#79c0ff">type&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>special
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl get pod --show-labels
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAME READY STATUS RESTARTS AGE LABELS
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubia-8z4mz 1/1 Running &lt;span style="color:#a5d6ff">0&lt;/span> 49m &lt;span style="color:#79c0ff">app&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>kubia
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubia-jlm79 1/1 Running &lt;span style="color:#a5d6ff">0&lt;/span> 30m &lt;span style="color:#79c0ff">app&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>kubia,type&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>special
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubia-wdlc8 1/1 Running &lt;span style="color:#a5d6ff">0&lt;/span> 30m &lt;span style="color:#79c0ff">app&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>kubia
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>更改己托管的od 的标签&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl label pod kubia-wdlc8 &lt;span style="color:#79c0ff">app&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>foo --overwrite
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAME READY STATUS RESTARTS AGE LABELS
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubia-8z4mz 1/1 Running &lt;span style="color:#a5d6ff">0&lt;/span> 53m &lt;span style="color:#79c0ff">app&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>kubia
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubia-jlm79 1/1 Running &lt;span style="color:#a5d6ff">0&lt;/span> 35m &lt;span style="color:#79c0ff">app&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>kubia,type&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>special
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubia-qz9dx 1/1 Running &lt;span style="color:#a5d6ff">0&lt;/span> 7s &lt;span style="color:#79c0ff">app&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>kubia
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubia-wdlc8 1/1 Running &lt;span style="color:#a5d6ff">0&lt;/span> 35m &lt;span style="color:#79c0ff">app&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>foo
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>由此可见，更改之后新建了&lt;/p>
&lt;/li>
&lt;li>
&lt;p>从控制器删除pod
当你想操作特定的 pod 时， 从 ReplicationController 管理范围中移除 pod 的操作很管用。例如，你可能有一个 bug 导致你的 pod 在特定时间或特定事件后开始出问题。如果你知道某个 pod 发生了故障， 就可以将它从 Replication-Controller 的管理范围中移除， 让控制器将它替换为新 pod, 接着这个 pod 就任你处置了。 完成后删除该pod 即可。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h4 id="425-修改pod模板">4.2.5 修改pod模板&lt;/h4>
&lt;p>打开现有的模板&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl edit rc kubia
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>打开现有的模板，我们添加一个新的标签&lt;/p>
&lt;p>输出&lt;code>replicationconColler &amp;quot;kubia&amp;quot; edited&lt;/code>&lt;/p>
&lt;p>下次新启动的pod就带你添加的 label&lt;/p>
&lt;blockquote>
&lt;p>配置kubectl edit使用不同的文本编辑器可以通过设置KUBE_EDITOR环境变量来告诉kubectl使用你期望的文本编辑器。 例如，如果你想使用nano编辑Kubernetes资源，请执行以下命令（或将其放入- /.bashrc或等效文件中）：&lt;/p>
&lt;p>export KUBE_EDITOR=&amp;quot;/usr/bin/nano&amp;quot;&lt;/p>
&lt;p>如果未设置KUBE_EDITOR环境变量， 则kubectl edted会回退到使用默认编辑器（通常通过EDITOR环境变量进行配置）。&lt;/p>
&lt;/blockquote>
&lt;h4 id="426-水平缩放pod">4.2.6 水平缩放pod&lt;/h4>
&lt;p>你已经看到了ReplicationController如何确保待续运行的pod实例 数量保持不变。因为改变副本的所需数量非常简单， 所以这也意味着水平缩放pod很简单。放大或者缩小pod的数量规模就和在ReplicationController资源中更改Replicas字段的值 一样简单。 更改之后，ReplicationController将 会看到存在太多的pod并删除其中的一部分（缩容时）， 或者看到它们数目太少并创建 pod (扩容时）。&lt;/p>
&lt;ol>
&lt;li>
&lt;p>ReplicationController扩容
现在的副本一直保持3，现在给扩容到10&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl scale rc kubia --replicas&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>&lt;span style="color:#a5d6ff">10&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>但这次你的做法会不一样。通过编辑定义来缩放ReplicationController&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl edit rc kubia
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>apiVersion: v1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kind: ReplicationController
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>metadata:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> creationTimestamp: &lt;span style="color:#a5d6ff">&amp;#34;2023-05-10T08:09:50Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> generation: &lt;span style="color:#a5d6ff">4&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> labels:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> app: kubia
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> name: kubia
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> namespace: default
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> resourceVersion: &lt;span style="color:#a5d6ff">&amp;#34;618771&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> uid: 337c97c4-1c94-4aba-885e-27ce02c8a378
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>spec:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> replicas: &lt;span style="color:#a5d6ff">10&lt;/span> &lt;span style="color:#8b949e;font-style:italic"># 这里修改&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> selector:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> app: kubia
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> template:
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>缩容
查看当前rc&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#查看&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kuvectl get rc
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#缩容&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl scale rc kubia --replicas&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>&lt;span style="color:#a5d6ff">3&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;p>伸缩集群的声明式方法
在 Kubernetes 中水平伸缩 pod 是陈述式的：＂我想要运行 x 个实例。”你不是告
诉 Kubernetes 做什么或如何去做， 只是指定了期望的状态。&lt;/p>
&lt;h4 id="427-删除一个replicationcontrolle">4.2.7 删除一个ReplicationControlle&lt;/h4>
&lt;p>默认删除 &lt;code>ReplicationController&lt;/code> 会删除同时关联的pod，有时候只要删除，添加 &lt;code>--cascade=false&lt;/code> 保持 &lt;code>ReplicationController&lt;/code> 删除，pod存活&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl delele rc kubia --cascade&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>false
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic"># 使用这个&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl delete rc kubia --cascade&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>orphan
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>&lt;del>kubectl delele rc kubia &amp;ndash;cascade=false&lt;/del> 已经被弃用&lt;/p>
&lt;p>warning: &amp;ndash;cascade=false is deprecated (boolean value) and can be replaced with &amp;ndash;cascade=orphan&lt;/p>
&lt;/blockquote>
&lt;h3 id="43-使用">4.3 使用&lt;/h3>
&lt;p>最 初， ReplicationController 是用于复制和在异常时重新调度节点的唯 一
Kubemetes 组件， 后来又引入了 一个名为 ReplicaSet 的类似资 源 。 它是新 一 代的
ReplicationController, 并且将 其完全替换掉 (ReplicationController 最终将被弃用）。&lt;/p>
&lt;h4 id="431-比较replicaset禾rl-replicationcontroller">4.3.1 比较ReplicaSet禾r:l ReplicationController&lt;/h4>
&lt;ul>
&lt;li>ReplicaSet 的行为与ReplicationController 完全相同， 但pod 选择器的表达能力
更强。 虽然 ReplicationController 的标签选择器只允许包含某个标签的匹配 pod, 但
ReplicaSet 的选择器还允许匹配缺少某个标签的 pod, 或包含特定标签名的 pod, 不
管其值如何。&lt;/li>
&lt;li>另外， 举个例子， 单个 Repli氓ionController 无法将 pod 与标签 env=produc巨on
和 env= devel 同时匹 配。 它只能匹 配带有 env=devel 标 签 的 pod 或带有
env= devel 标签的 pod。 但是 一个 ReplicaSet 可以匹配两组 pod 并将它们视为一个
大组。&lt;/li>
&lt;li>同样， 无论ReplicationController 的值如何， ReplicationController 都无法仅千
标签名的存在来匹配 pod, 而ReplicaSet 则可以。 例如， ReplicaSet 可匹配所有包含
名为 env 的标签的 pod, 无论ReplicaSet 的实际值是什么（可以理解为 env= *)。&lt;/li>
&lt;/ul>
&lt;h4 id="432-定义replicaset">4.3.2 定义ReplicaSet&lt;/h4>
&lt;p>我使用的版本是 &lt;code>v1.23.9&lt;/code>,书籍可能是老版本，beta功能&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7ee787">apiVersion&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">apps/v1 不是v1 版本 API的一部分，但属于 apps API组的v1beta2版本&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681">&lt;/span>&lt;span style="color:#7ee787">kind&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">ReplicaSet&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681">&lt;/span>&lt;span style="color:#7ee787">metadata&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">name&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">kubia&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681">&lt;/span>&lt;span style="color:#7ee787">spec&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">replicas&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">3&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">selector&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">matchLabels&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#8b949e;font-style:italic"># 这里使用了更简单的matchlabels选择器，类似于 ReplicationController的选择器&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">app&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">kubia&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">template&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">metadata&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">labels&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">app&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">kubia&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">spec&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">containers&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>- &lt;span style="color:#7ee787">name&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">kubia&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">image&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">luksa/kubia&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="433-创建和检查replicase">4.3.3 创建和检查ReplicaSe&lt;/h4>
&lt;p>查看&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl get rs
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>查看详细&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubbectl describe rs
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>- https://www.okrust.com/posts/kubenets-in-action/ - 2022-2023</description></item><item><title>kubernets 部署</title><link>https://www.okrust.com/posts/kubernets/</link><pubDate>Fri, 05 May 2023 01:12:16 +0800</pubDate><guid>https://www.okrust.com/posts/kubernets/</guid><description>redbunny https://www.okrust.com/posts/kubernets/ -&lt;h1 id="kubernets-部署">Kubernets 部署&lt;/h1>
&lt;blockquote>
&lt;p>踩坑更新中&lt;/p>
&lt;p>参考教程：&lt;a href="https://k8s.easydoc.net/docs/dRiQjyTY/28366845/6GiNOzyZ/nd7yOvdY">链接&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h2 id="docker安装">Docker安装&lt;/h2>
&lt;h3 id="一键脚本">一键脚本&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>curl -fsSL https://get.docker.com -o get-docker.sh
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo sh get-docker.sh
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Executing docker install script, commit: 7cae5f8b0decc17d6571f9f52eb840fbc13b2737
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;lt;...&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>&lt;a href="https://docs.docker.com/engine/install/ubuntu/">https://docs.docker.com/engine/install/ubuntu/&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h3 id="修改docker-driver方式">修改docker driver方式&lt;/h3>
&lt;p>查看&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo docker info | grep &lt;span style="color:#a5d6ff">&amp;#34;Cgroup Driver
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>如果不是 &lt;code>Cgroup Driver: systemd&lt;/code>,则使用下面的配置文件更改&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>vim /etc/docker/daemon.json
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#内容如下所示：&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a5d6ff">&amp;#34;exec-opts&amp;#34;&lt;/span>: &lt;span style="color:#ff7b72;font-weight:bold">[&lt;/span>&lt;span style="color:#a5d6ff">&amp;#34;native.cgroupdriver=systemd&amp;#34;&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a href="https://developer.aliyun.com/article/981452">相关文章&lt;/a>&lt;/p>
&lt;h2 id="镜像源获取">镜像源获取&lt;/h2>
&lt;p>&lt;a href="https://developer.aliyun.com/mirror/kubernetes">阿里云kubernets&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>apt-get update &lt;span style="color:#ff7b72;font-weight:bold">&amp;amp;&amp;amp;&lt;/span> apt-get install -y apt-transport-https
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add -
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cat &lt;span style="color:#a5d6ff">&amp;lt;&amp;lt;EOF &amp;gt;/etc/apt/sources.list.d/kubernetes.list
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a5d6ff">deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a5d6ff">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>apt-get update
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>apt-get install -y kubelet kubeadm kubectl
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>apt install -y &lt;span style="color:#79c0ff">kubelet&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>1.23.9-00 &lt;span style="color:#79c0ff">kubectl&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>1.23.9-00 &lt;span style="color:#79c0ff">kubeadm&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>1.23.9-00
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#apt-mark hold kubelet=1.23.9-00 kubectl=1.23.9-00 kubeadm=1.23.9-00&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>查询指定版本&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>apt-cache madison kubect |grep 1.23
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="初始化">初始化&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic"># 初始化集群控制台 Control plane&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic"># 失败了可以用 kubeadm reset 重置&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubeadm init --image-repository&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>registry.aliyuncs.com/google_containers
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic"># 记得把 kubeadm join xxx 保存起来&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic"># 忘记了重新获取：kubeadm token create --print-join-command&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic"># 复制授权文件，以便 kubectl 可以有权限访问集群&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic"># 如果你其他节点需要访问集群，需要从主节点复制这个文件过去其他节点&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">###获取加入&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubeadm join 192.168.0.199:6443 --token qfczz9.dg5thnmt2ts3aobx --discovery-token-ca-cert-hash sha256:543bdc5b8d07628e4f83b5754c084956058510e8870867f462971604bb7a3859
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="常见错误">常见错误&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl get pods
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#出现的错误 The connection to the server localhost:8080 was refused - did you specify the right host or port? &lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a href="https://stackoverflow.com/questions/45724889/the-connection-to-the-server-localhost8080-was-refused">相关文章&lt;/a>&lt;/p>
&lt;p>解决方法&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo mkdir -p &lt;span style="color:#79c0ff">$HOME&lt;/span>/.kube
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo cp -i /etc/kubernetes/admin.conf &lt;span style="color:#79c0ff">$HOME&lt;/span>/.kube/config
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo chown &lt;span style="color:#ff7b72">$(&lt;/span>id -u&lt;span style="color:#ff7b72">)&lt;/span>:&lt;span style="color:#ff7b72">$(&lt;/span>id -g&lt;span style="color:#ff7b72">)&lt;/span> &lt;span style="color:#79c0ff">$HOME&lt;/span>/.kube/config
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="安装网络同步插件">安装网络同步插件&lt;/h2>
&lt;blockquote>
&lt;p>主节点&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic"># 很有可能国内网络访问不到这个资源，你可以网上找找国内的源安装 flannel&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic"># 如果上面的插件安装失败，可以选用 Weave，下面的命令二选一就可以了。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#建议使用这个，这个安装成功&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl apply -f https://github.com/weaveworks/weave/releases/download/v2.8.1/weave-daemonset-k8s.yaml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl apply -f http://static.corecore.cn/weave.v2.8.1.yaml
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic"># 更多其他网路插件查看下面介绍，自行网上找 yaml 安装&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>https://blog.csdn.net/ChaITSimpleLove/article/details/117809007
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="报错的">报错的&lt;/h2>
&lt;ol>
&lt;li>
&lt;p>&lt;a href="https://stackoverflow.com/questions/40534837/kubernetes-installation-and-kube-dns-open-run-flannel-subnet-env-no-such-file">kubernetes installation and kube-dns: open /run/flannel/subnet.env: no such file or directory&lt;/a>&lt;/p>
&lt;p>使用其他的cni软件，不使用flannel&lt;/p>
&lt;pre tabindex="0">&lt;code>rm -f /etc/cni/net.d/*flannel*
&lt;/code>&lt;/pre>&lt;/li>
&lt;/ol>
- https://www.okrust.com/posts/kubernets/ - 2022-2023</description></item><item><title>git常用的指令</title><link>https://www.okrust.com/posts/git-common-commands/</link><pubDate>Mon, 10 Apr 2023 16:25:30 +0800</pubDate><guid>https://www.okrust.com/posts/git-common-commands/</guid><description>redbunny https://www.okrust.com/posts/git-common-commands/ -&lt;h2 id="更新子仓库">更新子仓库&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>git submodule update --init --recursive
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>git init 用于初始化本地仓库&lt;/li>
&lt;li>git add . 添加本地仓库的所有文件&lt;/li>
&lt;li>git commit -m ‘commit message’ 保存你对这些文件所做的更改&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://www.freecodecamp.org/news/content/images/2022/09/ss1-2.png" alt="">&lt;/p>
&lt;p>要推送 main 仓库，你首先必须通过运行 &lt;code>git remote add &amp;lt;url&amp;gt;&lt;/code> 将远程服务器添加到 Git。&lt;/p>
&lt;p>要确认已添加远程，请运行 &lt;code>git remote -v &lt;/code>&lt;/p>
&lt;p>&lt;a href="https://www.freecodecamp.org/news/content/images/2022/09/ss2-2.png">&lt;img src="" alt="">&lt;/a>&lt;/p>
&lt;p>推送到远程分支&lt;/p>
&lt;ol>
&lt;li>
&lt;p>推送当前分支 &lt;code>git push&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>创建新的分支,推送并远程仓库产生新的分支&lt;/p>
&lt;ol>
&lt;li>先运行 &lt;code>git branch branch-name&lt;/code> 创建新分支。 运行 &lt;code>git switch branch-name&lt;/code> 或 &lt;code>git checkout branch-name&lt;/code> 切到新建分支运行。
或者 使用 &lt;code>git checkout -b branch-name&lt;/code> 创建并切到当前分支。&lt;/li>
&lt;li>要将分支推送到远程服务器，请运行 &lt;code>git push –u origin&lt;/code>。就我而言，该分支的名称是 &lt;code>bug-fixes&lt;/code>，所以，我需要运行 &lt;code>git push -u origin bug-&lt;/code>fixes`
&lt;img src="https://www.freecodecamp.org/news/content/images/2022/09/ss4-2.png" alt="">&lt;/li>
&lt;li>成功远程新建分支&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>&lt;img src="https://www.freecodecamp.org/news/content/images/2022/09/ss5-2.png" alt="">&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>原文地址: &lt;a href="https://www.freecodecamp.org/chinese/news/git-push-local-branch-to-remote-how-to-publish-a-new-branch-in-git/">https://www.freecodecamp.org/chinese/news/git-push-local-branch-to-remote-how-to-publish-a-new-branch-in-git/&lt;/a>&lt;/p>
&lt;/blockquote>
- https://www.okrust.com/posts/git-common-commands/ - 2022-2023</description></item><item><title>Openwrt主路由使用端口回流失效</title><link>https://www.okrust.com/posts/openwrt-nat/</link><pubDate>Mon, 10 Apr 2023 16:09:04 +0800</pubDate><guid>https://www.okrust.com/posts/openwrt-nat/</guid><description>redbunny https://www.okrust.com/posts/openwrt-nat/ -&lt;h2 id="openwrt-解决方法">Openwrt 解决方法&lt;/h2>
&lt;ol>
&lt;li>
&lt;p>ssh连接openwrt系统后，编辑/etc/sysctl.d/11-br-netfilter.conf文件。&lt;/p>
&lt;p>&lt;code>net.bridge.bridge-nf-call-arptables=0&lt;/code>&lt;/p>
&lt;p>&lt;code>net.bridge.bridge-nf-call-ip6tables=0&lt;/code>&lt;/p>
&lt;p>&lt;code>net.bridge.bridge-nf-call-iptables=0&lt;/code>&lt;/p>
&lt;p>保证为后面的赋值为 &lt;code>0&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>编辑&lt;code>/etc/sysctl.conf&lt;/code>文件。文件内容可能是空的，把第一条的内容复制进sysctl.conf文件，保存退出。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ssh内输入&lt;code>sysctl -p&lt;/code>命令，结果输出为第一条的添加的字段&lt;/p>
&lt;/li>
&lt;li>
&lt;p>输入&lt;code>/etc/init.d/sysctl restart&lt;/code>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="方法来源">方法来源&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="http://www.kennylife.cn/index.php/x86_router/openwrt-NAT.html">http://www.kennylife.cn/index.php/x86_router/openwrt-NAT.html&lt;/a>&lt;/li>
&lt;/ul>
- https://www.okrust.com/posts/openwrt-nat/ - 2022-2023</description></item><item><title>hugo github Action 部署</title><link>https://www.okrust.com/posts/gitaction/</link><pubDate>Wed, 29 Mar 2023 15:05:16 +0800</pubDate><guid>https://www.okrust.com/posts/gitaction/</guid><description>redbunny https://www.okrust.com/posts/gitaction/ -&lt;h1 id="github配置">Github配置&lt;/h1>
&lt;h2 id="进入自己的仓库">进入自己的仓库&lt;/h2>
&lt;p>打开 setting -&amp;gt; Actions -&amp;gt; General, 找到 &lt;code>Workflow permissions&lt;/code>,选中 &lt;code>Read and write permissions&lt;/code>, 点击&lt;code>save&lt;/code>保存
&lt;img src="https://www.okrust.com/2023-03-29_14-37.png" alt=" 步骤1">
&lt;img src="https://www.okrust.com/2023-03-29_14-38.png" alt="">&lt;/p>
&lt;h2 id="远程服务器配置-rsync">远程服务器配置 rsync&lt;/h2>
&lt;h3 id="下载rsync">下载rsync&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo apt install rsync
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>添加配置文件&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo vim /etc/rsyncd.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72;font-weight:bold">[&lt;/span>blog&lt;span style="color:#ff7b72;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#79c0ff">path&lt;/span> &lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span> /var/www/hugo
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#79c0ff">comment&lt;/span> &lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span> web root
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>read &lt;span style="color:#79c0ff">only&lt;/span> &lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span> no
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#79c0ff">list&lt;/span> &lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span> yes
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#79c0ff">uid&lt;/span> &lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span> &lt;span style="color:#a5d6ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#79c0ff">gid&lt;/span> &lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span> &lt;span style="color:#a5d6ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>auth &lt;span style="color:#79c0ff">users&lt;/span> &lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span> myblog
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>secrets &lt;span style="color:#79c0ff">file&lt;/span> &lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span> /etc/rsyncd.secrets &lt;span style="color:#8b949e;font-style:italic">#用户的密码的文件配置目录&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>添加rsync用户登录密码&lt;/p>
&lt;p>存放的目录为配置文件里面的目录: rsync 密码格式 [用户名]:[密码]&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo vim /etc/rsyncd.secrets
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">##或者 echo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>echo &lt;span style="color:#a5d6ff">&amp;#34;myblog:123321&amp;#34;&lt;/span> &amp;gt; /etc/rsyncd.secrets
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>修改权限&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo chmod &lt;span style="color:#a5d6ff">0600&lt;/span> /etc/rsyncd.secrets
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>启动rsync&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo systemctl start rsync
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="配置github-actions">配置Github Actions&lt;/h2>
&lt;p>配置&lt;code>RSYNC_PASSWORD&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://www.okrust.com/2023-03-29_14-59.png" alt="">&lt;/p>
&lt;p>配置&lt;code>Github Actions&lt;/code>文件&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#7ee787">name&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">github pages&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681">&lt;/span>&lt;span style="color:#7ee787">on&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">push&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">branches&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>- &lt;span style="color:#a5d6ff">main &lt;/span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#8b949e;font-style:italic"># 这里是提交到master分支就立即触发job&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">pull_request&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681">&lt;/span>&lt;span style="color:#7ee787">jobs&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">deploy&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">runs-on&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">ubuntu-20.04&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">steps&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>- &lt;span style="color:#7ee787">uses&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">actions/checkout@v2&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">with&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">submodules&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#79c0ff">true&lt;/span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#8b949e;font-style:italic"># Fetch Hugo themes (true OR recursive)&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">fetch-depth&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">0&lt;/span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#8b949e;font-style:italic"># Fetch all history for .GitInfo and .Lastmod&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>- &lt;span style="color:#7ee787">name&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">Setup Hugo&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">uses&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">peaceiris/actions-hugo@v2&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">with&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">hugo-version&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">&amp;#39;0.111.2&amp;#39;&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">extended&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#79c0ff">true&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>- &lt;span style="color:#7ee787">name&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">Build&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">run&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">hugo --minify&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>- &lt;span style="color:#7ee787">name&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">Deploy Github&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">uses&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">peaceiris/actions-gh-pages@v3&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">with&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">github_token&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">${{ secrets.GITHUB_TOKEN }} &lt;/span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#8b949e;font-style:italic"># 这里不用动, 默认就好&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">publish_dir&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">./public &lt;/span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#8b949e;font-style:italic"># 注意是hugo的public文件夹&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">cname&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">www.XXXX.com&lt;/span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#8b949e;font-style:italic"># cname&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>- &lt;span style="color:#7ee787">name&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">Deploy to VPS&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">env&lt;/span>:&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">RSYNC_PWD&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#a5d6ff">${{ secrets.RSYNC_PASSWORD }}&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#6e7681"> &lt;/span>&lt;span style="color:#7ee787">run&lt;/span>:&lt;span style="color:#6e7681"> &lt;/span>|&lt;span style="color:#a5d6ff">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a5d6ff"> echo $RSYNC_PWD &amp;gt; rsync.pwd
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a5d6ff"> sudo chmod 600 rsync.pwd
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a5d6ff"> rsync -avP --delete public/* --password-file=rsync.pwd myblog@[ip]::blog&lt;/span>&lt;span style="color:#6e7681">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>- https://www.okrust.com/posts/gitaction/ - 2022-2023</description></item><item><title>国内镜像站</title><link>https://www.okrust.com/posts/mirrors/</link><pubDate>Wed, 29 Mar 2023 11:07:16 +0800</pubDate><guid>https://www.okrust.com/posts/mirrors/</guid><description>redbunny https://www.okrust.com/posts/mirrors/ -&lt;h3 id="镜像源">镜像源&lt;/h3>
&lt;p>&lt;a href="https://mirrors.tuna.tsinghua.edu.cn/">清华源&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>https://mirrors.tuna.tsinghua.edu.cn/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a href="https://mirrors.huaweicloud.com/home">华为镜像源&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>https://mirrors.huaweicloud.com/home
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a href="https://developer.aliyun.com/mirror/">阿里源&lt;/a>&lt;/p>
&lt;pre tabindex="0">&lt;code>https://developer.aliyun.com/mirror/
&lt;/code>&lt;/pre>&lt;p>&lt;a href="https://mirrors.cloud.tencent.com/">腾讯源&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>https://mirrors.cloud.tencent.com/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a href="https://mirrors.163.com/">163源&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>https://mirrors.163.com/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h3 id="windows系统下载">Windows系统下载&lt;/h3>
&lt;p>&lt;a href="https://msdn.itellyou.cn/">msdn老版&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://next.itellyou.cn/">msdn新版&lt;/a>&lt;/p>
&lt;h3 id="npm源">Npm源&lt;/h3>
&lt;p>&lt;a href="https://npmmirror.com/">阿里源&lt;/a>&lt;/p>
&lt;ul>
&lt;li>开源镜像: &lt;a href="https://npmmirror.com/mirrors/?spm=a2c6h.24755359.0.0.6d444dcc7N3fDO">https://npmmirror.com/mirrors/&lt;/a>&lt;/li>
&lt;li>Node.js 镜像: &lt;a href="https://npmmirror.com/mirrors/node/">https://npmmirror.com/mirrors/node/&lt;/a>&lt;/li>
&lt;li>alinode 镜像: &lt;a href="https://npmmirror.com/mirrors/alinode/">https://npmmirror.com/mirrors/alinode/&lt;/a>&lt;/li>
&lt;li>ChromeDriver 镜像: &lt;a href="https://npmmirror.com/mirrors/chromedriver/">https://npmmirror.com/mirrors/chromedriver/&lt;/a>&lt;/li>
&lt;li>OperaDriver 镜像: &lt;a href="https://npmmirror.com/mirrors/operadriver/">https://npmmirror.com/mirrors/operadriver/&lt;/a>&lt;/li>
&lt;li>Selenium 镜像: &lt;a href="https://npmmirror.com/mirrors/selenium/?spm=a2c6h.24755359.0.0.6d444dcc7N3fDO">https://npmmirror.com/mirrors/selenium/&lt;/a>&lt;/li>
&lt;li>electron 镜像: &lt;a href="https://npmmirror.com/mirrors/electron/">https://npmmirror.com/mirrors/electron/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>使用说明&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>
&lt;p>你可以使用我们定制的 &lt;a href="https://github.com/cnpm/cnpm">cnpm&lt;/a> (gzip 压缩支持) 命令行工具代替默认的 &lt;code>npm&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ npm install -g cnpm --registry&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>https://registry.npmmirror.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>或者你直接通过添加 &lt;code>npm&lt;/code> 参数 &lt;code>alias&lt;/code> 一个新命令:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>alias &lt;span style="color:#79c0ff">cnpm&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>&lt;span style="color:#a5d6ff">&amp;#34;npm --registry=https://registry.npmmirror.com \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a5d6ff">--cache=&lt;/span>&lt;span style="color:#79c0ff">$HOME&lt;/span>&lt;span style="color:#a5d6ff">/.npm/.cache/cnpm \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a5d6ff">--disturl=https://npmmirror.com/mirrors/node \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a5d6ff">--userconfig=&lt;/span>&lt;span style="color:#79c0ff">$HOME&lt;/span>&lt;span style="color:#a5d6ff">/.cnpmrc&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic"># Or alias it in .bashrc or .zshrc&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ echo &lt;span style="color:#a5d6ff">&amp;#39;\n#alias for cnpm\nalias cnpm=&amp;#34;npm --registry=https://registry.npmmirror.com \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a5d6ff"> --cache=$HOME/.npm/.cache/cnpm \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a5d6ff"> --disturl=https://npmmirror.com/mirrors/node \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a5d6ff"> --userconfig=$HOME/.cnpmrc&amp;#34;&amp;#39;&lt;/span> &amp;gt;&amp;gt; ~/.zshrc &lt;span style="color:#ff7b72;font-weight:bold">&amp;amp;&amp;amp;&lt;/span> source ~/.zshrc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>安装模块&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>cnpm install &lt;span style="color:#ff7b72;font-weight:bold">[&lt;/span>name&lt;span style="color:#ff7b72;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>更新模块&lt;/p>
&lt;p>直接通过 &lt;code>sync&lt;/code> 命令马上同步一个模块, 只有 &lt;code>cnpm&lt;/code> 命令行才有此功能&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>cnpm sync express
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>当然, 你可以直接通过 web 方式来同步: &lt;a href="https://npmmirror.com/sync/express">/sync/express&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span> open https://npmmirror.com/sync/express
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>其他命令&lt;/p>
&lt;p>支持 &lt;code>npm&lt;/code> 除了 &lt;code>publish&lt;/code> 之外的所有命令, 如:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span> cnpm info express
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>官网有更详细的教程使用&lt;/p>
&lt;/blockquote>
&lt;hr>
&lt;h3 id="pip源">Pip源&lt;/h3>
&lt;p>清华大学：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>https://pypi.tuna.tsinghua.edu.cn/simple
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>阿里云：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>http://mirrors.aliyun.com/pypi/simple/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>腾讯云：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>https://mirrors.cloud.tencent.com/pypi/simple/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>中国科技大学：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>https://mirrors.cloud.tencent.com/pypi/simple/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>豆瓣：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>https://pypi.doubanio.com/simple/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>浙江大学：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>https://mirrors.zju.edu.cn/pypi/web/simple/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>使用教程&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>
&lt;p>临时使用&lt;/p>
&lt;p>在pip后面加上参数 &lt;code>-i&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>pip install scrapy -i https://mirrors.aliyun.com/pypi/simple
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>永久使用&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Linux&lt;/p>
&lt;p>修改&lt;code> ~/.pip/pip.conf&lt;/code> (没有就创建一个)， 内容如下:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72;font-weight:bold">[&lt;/span>global&lt;span style="color:#ff7b72;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>index-url &lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span> https://mirrors.aliyun.com/pypi/simple
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>Windows&lt;/p>
&lt;p>直接在user目录中创建一个pip目录，如：C:\Users\xx\pip，新建文件pip.ini，内容如下,或者 win+R ，输入&lt;code>%homepath%&lt;/code>下面新建 pip文件夹，进入pip文件夹新建 pip.ini&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72;font-weight:bold">[&lt;/span>global&lt;span style="color:#ff7b72;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>index-url &lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span> https://mirrors.aliyun.com/pypi/simple
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>其他&lt;/p>
&lt;p>报错：如果报错 &amp;ldquo;The repository located at mirrors.aliyun.com is not a trusted … &amp;ldquo;的情况&lt;/p>
&lt;ol>
&lt;li>
&lt;p>一次性解决：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>pip install scrapy -i http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>永久解决：在pip.conf下添加：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72;font-weight:bold">[&lt;/span>global&lt;span style="color:#ff7b72;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>trusted-host&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>mirrors.aliyun.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="golang源">GoLang源&lt;/h3>
&lt;ul>
&lt;li>七牛：Goproxy 中国 &lt;a href="https://goproxy.cn">https://goproxy.cn&lt;/a>&lt;/li>
&lt;li>阿里： &lt;a href="https://mirrors.aliyun.com/goproxy/">https://mirrors.aliyun.com/goproxy/&lt;/a>&lt;/li>
&lt;li>官方： 全球CDN加速 &lt;a href="https://goproxy.io/">https://goproxy.io/&lt;/a>&lt;/li>
&lt;li>其他：jfrog 维护 &lt;a href="https://gocenter.io">https://gocenter.io&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>设置代理&lt;/p>
&lt;ol>
&lt;li>
&lt;p>类 Unix(linux)&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic"># 启用 Go Modules 功能&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>go env -w &lt;span style="color:#79c0ff">GO111MODULE&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>on
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic"># 配置 GOPROXY 环境变量，举一个栗子&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>go env -w &lt;span style="color:#79c0ff">GOPROXY&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>https://goproxy.cn,direct
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>查看是否完成设置完成&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>go env | grep GOPROXY
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#显示成功&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#79c0ff">GOPROXY&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>&lt;span style="color:#a5d6ff">&amp;#34;https://goproxy.cn,direct&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>Windows&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cmd" data-lang="cmd">&lt;span style="display:flex;">&lt;span># 启用 Go Modules 功能
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$env:GO111MODULE=&lt;span style="color:#a5d6ff">&amp;#34;on&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span># 配置 GOPROXY 环境变量，举一个栗子
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$env:GOPROXY=&lt;span style="color:#a5d6ff">&amp;#34;https://goproxy.cn,direct&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>查看是否完成设置完成&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-cmd" data-lang="cmd">&lt;span style="display:flex;">&lt;span>go env
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>#找到这一行则可以了
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72">set&lt;/span> &lt;span style="color:#79c0ff">GOPROXY&lt;/span>=https://goproxy.cn,direct
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="rust源">Rust源&lt;/h3>
&lt;p>中国科学技术大学&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#git协议&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git://mirrors.ustc.edu.cn/crates.io-index
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#http&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>http://mirrors.ustc.edu.cn/crates.io-index
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>上海交通大学&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>https://mirrors.sjtug.sjtu.edu.cn/git/crates.io-index
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>清华大学&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>https://mirrors.tuna.tsinghua.edu.cn/git/crates.io-index.git
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>rustcc社区&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>https://code.aliyun.com/rustcc/crates.io-index.git
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol>
&lt;li>
&lt;p>类 Unix(Linux)&lt;/p>
&lt;p>创建 &lt;code>$HOME/.cargo/config&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72;font-weight:bold">[&lt;/span>source.crates-io&lt;span style="color:#ff7b72;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#79c0ff">registry&lt;/span> &lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span> &lt;span style="color:#a5d6ff">&amp;#34;https://github.com/rust-lang/crates.io-index&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic"># 指定镜像&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>replace-with &lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span> &lt;span style="color:#a5d6ff">&amp;#39;镜像源名&amp;#39;&lt;/span> &lt;span style="color:#8b949e;font-style:italic"># 如：tuna、sjtu、ustc，或者 rustcc&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#replace-with = &amp;#39;tuna&amp;#39; &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic"># 注：以下源配置一个即可，无需全部&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic"># 中国科学技术大学&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72;font-weight:bold">[&lt;/span>source.ustc&lt;span style="color:#ff7b72;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#79c0ff">registry&lt;/span> &lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span> &lt;span style="color:#a5d6ff">&amp;#34;git://mirrors.ustc.edu.cn/crates.io-index&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic"># 上海交通大学&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72;font-weight:bold">[&lt;/span>source.sjtu&lt;span style="color:#ff7b72;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#79c0ff">registry&lt;/span> &lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span> &lt;span style="color:#a5d6ff">&amp;#34;https://mirrors.sjtug.sjtu.edu.cn/git/crates.io-index&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic"># 清华大学&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72;font-weight:bold">[&lt;/span>source.tuna&lt;span style="color:#ff7b72;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#79c0ff">registry&lt;/span> &lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span> &lt;span style="color:#a5d6ff">&amp;#34;https://mirrors.tuna.tsinghua.edu.cn/git/crates.io-index.git&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic"># rustcc社区&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72;font-weight:bold">[&lt;/span>source.rustcc&lt;span style="color:#ff7b72;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#79c0ff">registry&lt;/span> &lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span> &lt;span style="color:#a5d6ff">&amp;#34;https://code.aliyun.com/rustcc/crates.io-index.git&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>Windows&lt;/p>
&lt;p>直接在user目录中创建一个pip目录，如：C:\Users\[用户名]\.cargo\config，内容如下,或者 win+R ，输入&lt;code>%homepath%&lt;/code>下面新建 .cargo文件夹，进入pip文件夹新建config&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-txt" data-lang="txt">&lt;span style="display:flex;">&lt;span>[registry]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>index = &amp;#34;https://mirrors.ustc.edu.cn/crates.io-index/&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[source.crates-io]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>replace-with = &amp;#39;ustc&amp;#39;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>[source.ustc]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>registry = &amp;#34;https://mirrors.ustc.edu.cn/crates.io-index/&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h3 id="git加速源">Git加速源&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://hub.fastgit.org">https://hub.fastgit.org&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com.cnpmjs.org">https://github.com.cnpmjs.org&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://gitclone.com/">https://gitclone.com/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>使用教程&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#源git克隆&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git clone https://github.com/gin-gonic/gin.git
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic">#加速&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git clone https://gitclone/gin-gonic/gin.git
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h3 id="各个源版本大合集">各个源版本大合集&lt;/h3>
&lt;p>这里只列出常用的几个&lt;/p>
&lt;p>更多请点击 &lt;a href="https://mirrors.ustc.edu.cn/help/">USTC Mirror&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>https://mirrors.ustc.edu.cn/help/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>- https://www.okrust.com/posts/mirrors/ - 2022-2023</description></item><item><title>Hello</title><link>https://www.okrust.com/posts/hello/</link><pubDate>Tue, 28 Mar 2023 11:04:02 +0800</pubDate><guid>https://www.okrust.com/posts/hello/</guid><description>redbunny https://www.okrust.com/posts/hello/ -&lt;h1 id="hello-hugo">hello hugo&lt;/h1>
&lt;p>hello okrust&lt;/p>
- https://www.okrust.com/posts/hello/ - 2022-2023</description></item></channel></rss>