<!doctype html><html><head><title>Kubenets in Action cli</title><meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><meta name=google-site-verification content><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name=viewport><meta content="telephone=no" name=format-detection><meta name=description content="kubernets in action 所使用的的指令"><meta name=renderer content="webkit"><meta name=theme-color content="#ffffff"><script async src="https://www.googletagmanager.com/gtag/js?id=G-GT370SNKC1"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GT370SNKC1",{anonymize_ip:!1})}</script><link rel=icon href=https://www.okrust.com/favicon.png><script src=/js/toc.js></script>
<link type=text/css rel=stylesheet href=/vendor/css/bootstrap.min.css><link rel=stylesheet href=/scss/journal.min.7c01e9f6fb2f6083d79d2f3a32ec6b7901e262e94a52a64a542aef98bc5bda64.css integrity="sha256-fAHp9vsvYIPXnS86MuxreQHiYulKUqZKVCrvmLxb2mQ=" media=screen><link rel=stylesheet href=/scss/dark-mode.min.cb53f1bee2b8900cb4f082afbf00175d6618f281cf9a2fe8619e3b52d20b5721.css integrity="sha256-y1PxvuK4kAy08IKvvwAXXWYY8oHPmi/oYZ47UtILVyE=" media=screen><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Material+Icons"></head><body><div id=app><div class=single-column-drawer-container id=drawer v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }"><div class=drawer-content><div class=drawer-menu><a class="a-block drawer-menu-item active" href=/posts>Archive</a>
<a class="a-block drawer-menu-item false" href=/tags>Tags</a>
<a class="a-block drawer-menu-item false" href=/categories>Categories</a><div class=toc><div class=toc-content><center>- CATALOG -</center><ul><li><a href=#%e5%b8%b8%e7%94%a8%e6%8c%87%e4%bb%a4 class=nav-常用指令>常用指令</a></li><ul><li><a href=#2%e5%bc%80%e5%a7%8b%e4%bd%bf%e7%94%a8kubernets-%e5%92%8cdocker class=nav-2开始使用kubernets-和docker>2.开始使用kubernets 和docker</a></li><ul><li><a href=#1-%e5%88%9b%e5%bb%ba%e8%bf%90%e8%a1%8c%e5%8f%8a%e5%85%b1%e4%ba%ab%e5%ae%b9%e5%99%a8%e9%95%9c%e5%83%8f class=nav-1-创建运行及共享容器镜像>1. 创建、运行及共享容器镜像</a></li><li><a href=#3-%e8%bf%90%e8%a1%8c%e7%ac%ac%e4%b8%80%e4%b8%aa%e7%a8%8b%e5%ba%8f class=nav-3-运行第一个程序>3. 运行第一个程序</a></li><ul><li><a href=#2%e8%ae%bf%e9%97%ae%e7%ac%acweb-%e5%ba%94%e7%94%a8 class=nav-2访问第web-应用>2.访问第web 应用</a></li></ul></ul><li><a href=#3%e8%bf%90%e8%a1%8c%e4%ba%8ekuberntes-%e4%b8%ad%e7%9a%84%e5%ae%b9%e5%99%a8 class=nav-3运行于kuberntes-中的容器>3.运行于Kuberntes 中的容器</a></li><li><a href=#32-%e4%bb%a5yaml%e6%88%96%e8%80%85json%e6%96%87%e4%bb%b6%e5%88%9b%e5%bb%bapod class=nav-32-以yaml或者json文件创建pod>3.2 以YAML或者JSON文件创建pod</a></li><ul><ul><li><a href=#321-%e6%a3%80%e6%9f%a5%e7%8e%b0%e6%9c%89%e7%9a%84yaml%e6%8f%8f%e8%bf%b0 class=nav-321-检查现有的yaml描述>3.2.1 检查现有的yaml描述</a></li><li><a href=#323-kubectl-create-%e5%88%9b%e5%bb%bapod class=nav-323-kubectl-create-创建pod>3.2.3 kubectl create 创建pod</a></li><li><a href=#324-%e6%9f%a5%e7%9c%8b%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f%e6%97%a5%e5%bf%97 class=nav-324-查看应用程序日志>3.2.4 查看应用程序日志</a></li><li><a href=#325-%e5%90%91pod%e5%8f%91%e9%80%81%e8%af%b7%e6%b1%82 class=nav-325-向pod发送请求>3.2.5 向pod发送请求</a></li></ul><li><a href=#33-%e4%bd%bf%e7%94%a8%e6%a0%87%e7%ad%be%e7%bb%84%e7%bb%87pod class=nav-33-使用标签组织pod>3.3 使用标签组织pod</a></li><ul><li><a href=#332-%e5%88%9b%e5%bb%bapod%e6%a0%87%e7%ad%belabels class=nav-332-创建pod标签labels>3.3.2 创建pod标签labels</a></li><li><a href=#333-%e4%bf%ae%e6%94%b9%e6%b7%bb%e5%8a%a0pod-%e6%a0%87%e7%ad%be-labels class=nav-333-修改添加pod-标签-labels>3.3.3 修改添加pod 标签 labels</a></li></ul><li><a href=#34-%e9%80%9a%e8%bf%87%e6%a0%87%e7%ad%be%e9%80%89%e6%8b%a9%e5%99%a8%e5%88%97%e5%87%bapod%e5%ad%90%e9%9b%86 class=nav-34-通过标签选择器列出pod子集>3.4 通过标签选择器列出pod子集</a></li><ul><li><a href=#341-%e4%bd%bf%e7%94%a8%e6%a0%87%e7%ad%be%e9%80%89%e6%8b%a9%e5%99%a8%e5%88%97%e5%87%bapod class=nav-341-使用标签选择器列出pod>3.4.1 使用标签选择器列出pod</a></li><li><a href=#342-%e5%9c%a8%e6%a0%87%e7%ad%be%e9%80%89%e6%8b%a9%e5%99%a8%e4%b8%ad%e4%bd%bf%e7%94%a8%e5%a4%9a%e4%b8%aa%e6%9d%a1%e4%bb%b6 class=nav-342-在标签选择器中使用多个条件>3.4.2 在标签选择器中使用多个条件</a></li></ul><li><a href=#35-%e4%bd%bf%e7%94%a8%e6%a0%87%e7%ad%be%e5%92%8c%e9%80%89%e6%8b%a9%e5%99%a8%e6%9d%a5%e7%ba%a6%e6%9d%9fpod%e8%b0%83%e5%ba%a6 class=nav-35-使用标签和选择器来约束pod调度>3.5 使用标签和选择器来约束pod调度</a></li><ul><li><a href=#351-%e4%bd%bf%e7%94%a8%e6%a0%87%e7%ad%be%e5%88%86%e7%b1%bb%e5%b7%a5%e4%bd%9c%e8%8a%82%e7%82%b9 class=nav-351-使用标签分类工作节点>3.5.1 使用标签分类工作节点</a></li><li><a href=#352-%e5%b0%86pod%e8%b0%83%e5%ba%a6%e5%88%b0%e7%89%b9%e5%ae%9a%e8%8a%82%e7%82%b9 class=nav-352-将pod调度到特定节点>3.5.2 将pod调度到特定节点</a></li></ul><li><a href=#36-%e6%b3%a8%e8%a7%a3pod class=nav-36-注解pod>3.6 注解pod</a></li><ul><li><a href=#361-%e6%9f%a5%e6%89%be%e5%af%b9%e8%b1%a1%e7%9a%84%e6%b3%a8%e8%a7%a3 class=nav-361-查找对象的注解>3.6.1 查找对象的注解</a></li><li><a href=#362-%e6%b7%bb%e5%8a%a0%e5%92%8c%e4%bf%ae%e6%94%b9%e6%b3%a8%e8%a7%a3 class=nav-362-添加和修改注解>3.6.2 添加和修改注解</a></li></ul><li><a href=#37-%e4%bd%bf%e7%94%a8%e5%91%bd%e5%90%8d%e7%a9%ba%e9%97%b4%e5%af%b9%e8%b5%84%e6%ba%90%e8%bf%9b%e8%a1%8c%e5%88%86%e7%bb%84 class=nav-37-使用命名空间对资源进行分组>3.7 使用命名空间对资源进行分组</a></li><ul><li><a href=#372-%e5%8f%91%e7%8e%b0%e5%85%b6%e4%bb%96%e5%91%bd%e5%90%8d%e7%a9%ba%e9%97%b4%e5%8f%8a%e5%85%b6-pod class=nav-372-发现其他命名空间及其-pod>3.7.2 发现其他命名空间及其 pod</a></li></ul></div></div></div></div></div><transition name=fade><div id=drawer-mask v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if=isDrawerOpen v-on:click=toggleDrawer></div></transition><nav id=navBar class="navbar sticky-top navbar-light single-column-nav-container"><div id=navBackground class=nav-background></div><div class="container container-narrow nav-content"><button id=nav_dropdown_btn class=nav-dropdown-toggle type=button v-on:click=toggleDrawer>
<i class=material-icons>menu</i></button>
<a id=navTitle class=navbar-brand href=https://www.okrust.com/>okrust</a>
<button type=button class=nav-darkmode-toggle id=darkModeToggleButton2>
<i class=material-icons id=darkModeToggleIcon2>dark_mode</i></button></div></nav><div class=single-column-header-container id=pageHead v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }"><a href=https://www.okrust.com/><div class=single-column-header-title>okrust</div></a></div><div id=content><div id=streamContainer class=stream-container><div class="post-list-container post-list-container-shadow"><div class=post><div class=post-head-wrapper style=background-image:url(https://w.wallhaven.cc/full/ex/wallhaven-ex9gwo.png)><div class=post-title>Kubenets in Action cli<div class=post-subtitle>kubernets in action 所使用的的指令</div><div class=post-meta><time itemprop=datePublished>2023-05-05 16:33</time>
<i class=material-icons>folder</i>
<a href=/categories/book>book</a>
&nbsp;
<i class=material-icons>label</i>
<a href=/tags/kubernets>kubernets</a>
&nbsp;
<a href=/tags/linux>linux</a>
&nbsp;</div></div></div><div class=post-body-wrapper><div class=post-body v-pre><h1 id=常用指令>常用指令</h1><blockquote><p>学习中文档不全,慢慢整理&mldr;..</p></blockquote><h2 id=2开始使用kubernets-和docker>2.开始使用kubernets 和docker</h2><h3 id=1-创建运行及共享容器镜像>1. 创建、运行及共享容器镜像</h3><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker build -t kubia .
</span></span></code></pre></div><h3 id=3-运行第一个程序>3. 运行第一个程序</h3><h4 id=2访问第web-应用>2.访问第web 应用</h4><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl expose rc kubia --type<span style=color:#ff7b72;font-weight:700>=</span>LoadBalancer --name kubia-http
</span></span></code></pre></div><blockquote><p>我们这里用的是replicationtroller的缩写rc。大 多数资源类型都有这样的缩写，所以不必输入全名（例如，pods的缩写是po,service的缩写是SVC，等等）列出服务</p></blockquote><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get service
</span></span><span style=display:flex><span>kubectl get svc
</span></span></code></pre></div><p>水平伸缩应用</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get replicationcontrollers
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME    DESIRED   CURRENT   READY  AGE                                                                                                                                                           
</span></span><span style=display:flex><span>kubia   <span style=color:#a5d6ff>1</span>         <span style=color:#a5d6ff>1</span>         <span style=color:#a5d6ff>1</span>      32m
</span></span></code></pre></div><blockquote><p>DESIRED 副本数量 ,CURRENT 希望运行的pod数量</p></blockquote><p>增加副本数量</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl scale rc kubia --replicas<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME    DESIRED   CURRENT   READY   AGE                                                                              
</span></span><span style=display:flex><span>kubia   <span style=color:#a5d6ff>3</span>         <span style=color:#a5d6ff>3</span>         <span style=color:#a5d6ff>1</span>       34m
</span></span></code></pre></div><p>如过有多个副本，则会均衡负载</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@master:/home/ubuntu/kubernetes-in-action-v1-notes/Chapter02# kubectl  get po                                                                               
</span></span><span style=display:flex><span>NAME          READY   STATUS    RESTARTS   AGE                                                                              
</span></span><span style=display:flex><span>kubia-chlfj   1/1     Running   <span style=color:#a5d6ff>0</span>          2m19s                                                                            
</span></span><span style=display:flex><span>kubia-lrql6   1/1     Running   <span style=color:#a5d6ff>0</span>          36m                                                                              
</span></span><span style=display:flex><span>kubia-qk7mv   1/1     Running   <span style=color:#a5d6ff>0</span>          2m19s                                                                                                                                                     
</span></span><span style=display:flex><span>root@master:/home/ubuntu/kubernetes-in-action-v1-notes/Chapter02# kubectl  get service                                                                          
</span></span><span style=display:flex><span>NAME         TYPE           CLUSTER-IP       EXTERNAL-IP   PORT<span style=color:#ff7b72;font-weight:700>(</span>S<span style=color:#ff7b72;font-weight:700>)</span>          AGE                                                                              
</span></span><span style=display:flex><span>kubernetes   ClusterIP      10.96.0.1        &lt;none&gt;        443/TCP          56m                                                                              
</span></span><span style=display:flex><span>kubia-http   LoadBalancer   10.104.229.236   &lt;pending&gt;     8080:31338/TCP   11m                                                                              
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>root@master:/home/ubuntu/kubernetes-in-action-v1-notes/Chapter02# curl 10.104.229.236:8080                                                                         
</span></span><span style=display:flex><span>You<span style=color:#a5d6ff>&#39;ve hit kubia-lrql6                                                                      
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>root@master:/home/ubuntu/kubernetes-in-action-v1-notes/Chapter02# curl 10.104.229.236:8080                                                                         
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>You&#39;</span>ve hit kubia-qk7mv                                                                      
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>root@master:/home/ubuntu/kubernetes-in-action-v1-notes/Chapter02# curl 10.104.229.236:8080                                                                         
</span></span><span style=display:flex><span>You<span style=color:#a5d6ff>&#39;ve hit kubia-qk7mv                                                                      
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>root@master:/home/ubuntu/kubernetes-in-action-v1-notes/Chapter02# curl 10.104.229.236:8080                                                                         
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>You&#39;</span>ve hit kubia-lrql6                                                                      
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>root@master:/home/ubuntu/kubernetes-in-action-v1-notes/Chapter02# curl 10.104.229.236:8080                                                                         
</span></span><span style=display:flex><span>You<span style=color:#a5d6ff>&#39;ve hit kubia-qk7mv                                                                      
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>root@master:/home/ubuntu/kubernetes-in-action-v1-notes/Chapter02# curl 10.104.229.236:8080                                                                         
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>You&#39;</span>ve hit kubia-qk7mv         
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>oot@master:/home/ubuntu/kubernetes-in-action-v1-notes/Chapter02# curl 10.104.229.236:8080                                                                         
</span></span><span style=display:flex><span>You<span style=color:#f85149>&#39;</span>ve hit kubia-chlfj
</span></span></code></pre></div><p>列出 pod 时显示 pod IP 和 pod 的节点</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pods -o wide
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME          READY   STATUS    RESTARTS   AGE     IP          NODE    NOMINATED NODE   READINESS GATES 
</span></span><span style=display:flex><span>kubia-chlfj   1/1     Running   <span style=color:#a5d6ff>0</span>          8m49s   10.40.0.2   node2   &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>kubia-lrql6   1/1     Running   <span style=color:#a5d6ff>0</span>          42m     10.40.0.1   node2   &lt;none&gt;           &lt;none&gt;
</span></span><span style=display:flex><span>kubia-qk7mv   1/1     Running   <span style=color:#a5d6ff>0</span>          8m49s   10.38.0.1   node1   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><p>查看pod详细信息</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl describe pod kubia-chlfj
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Name:         kubia-chlfj                           
</span></span><span style=display:flex><span>Namespace:    default                             
</span></span><span style=display:flex><span>Priority:     <span style=color:#a5d6ff>0</span>           
</span></span><span style=display:flex><span>Node:         node2/192.168.0.201
</span></span><span style=display:flex><span>Start Time:   Fri, <span style=color:#a5d6ff>05</span> May <span style=color:#a5d6ff>2023</span> 09:04:47 +0000
</span></span><span style=display:flex><span>Labels:       <span style=color:#79c0ff>run</span><span style=color:#ff7b72;font-weight:700>=</span>kubia                                    
</span></span><span style=display:flex><span>Annotations:  &lt;none&gt;                       
</span></span><span style=display:flex><span>Status:       Running
</span></span><span style=display:flex><span>IP:           10.40.0.2
</span></span><span style=display:flex><span>IPs:                                                                         
</span></span><span style=display:flex><span>  IP:           10.40.0.2                                 
</span></span><span style=display:flex><span>Controlled By:  ReplicationController/kubia
</span></span></code></pre></div><p>访问GKE集群dashbord</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl cluster-info | grep dashboard
</span></span></code></pre></div><blockquote><p>如果你正在使 用 Google Kubemetes Engine</p></blockquote><h2 id=3运行于kuberntes-中的容器>3.运行于Kuberntes 中的容器</h2><h2 id=32-以yaml或者json文件创建pod>3.2 以YAML或者JSON文件创建pod</h2><h4 id=321-检查现有的yaml描述>3.2.1 检查现有的yaml描述</h4><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get po kubia-zxzij -o yaml
</span></span></code></pre></div><p><img src=/kubernet-in-action/2023-03-29_14-37.png alt=yaml>
<img src=/kubernet-in-action/2023-05-05_17-41.png alt=yaml></p><ul><li>metadata包括名称、命名空间、标 签和关于该容器 的其他信息。</li><li>spec包含p od内容的实际说明，例如p od的容器、卷和其他数据。</li><li>status包含运行中的pod的当前信息，例如po d所处的条件、每个容器的描述和状态，以及内部IP和其他基本信息</li></ul><p>使用 kubectl explain 来发现可能的 API 对象字段</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic>#在准备 manifest 时，可以转到 http: //kubemetes.io / docs /api 上的 Kubemetes参考文档查看每个 API 对象支持哪些属性，也可以使用 kubectl explain 命令 。例如，当从头创建一个 pod manifest 时，可以从请求 kubectl 来解释 pod 开始：</span>
</span></span><span style=display:flex><span>kubectl explain pods
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl explain pod.spec
</span></span></code></pre></div><h4 id=323-kubectl-create-创建pod>3.2.3 kubectl create 创建pod</h4><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create -f kubia-manual.yam
</span></span></code></pre></div><p>得到pod完整定义</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get po kubia-manual -o yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl get po kubia-manual -o json
</span></span></code></pre></div><p>查看新建的pod</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pods
</span></span></code></pre></div><h4 id=324-查看应用程序日志>3.2.4 查看应用程序日志</h4><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl logs kubia-manual
</span></span></code></pre></div><p>如果包含多个pod 的日志时指定容器名称</p><p>如果我们的pod包含多个容器， 在运行kubectl logs命令时则必须通过包含-c &lt;容器名称＞选项来显式指定容器名称。 在kubia-manual pod中， 我们将容器的名称设置为kubia, 所以如果该pod中有其他容器， 可以通过如下命令获取其日志</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl logs kubia-manual -c kubia
</span></span></code></pre></div><h4 id=325-向pod发送请求>3.2.5 向pod发送请求</h4><p>将本地网络端口转发到 pod 中的端口</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl  port-forward kubia-manual 8888:8080
</span></span></code></pre></div><h3 id=33-使用标签组织pod>3.3 使用标签组织pod</h3><h4 id=332-创建pod标签labels>3.3.2 创建pod标签labels</h4><p>创建pod</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create -f kubia-manual-with-labels.yaml
</span></span></code></pre></div><p>查看标签</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get po --show-labels
</span></span></code></pre></div><p>查看指定的标签 labels,然后分组出来</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get po -L creation_method,env
</span></span></code></pre></div><p><img src=/kubernet-in-action/3.3.2/2023-05-06_17-08.png alt=img></p><h4 id=333-修改添加pod-标签-labels>3.3.3 修改添加pod 标签 labels</h4><p>新增标签</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl label po kubia-manual <span style=color:#79c0ff>creation_method</span><span style=color:#ff7b72;font-weight:700>=</span>manual
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>#pod/kubia-manual labeled</span>
</span></span></code></pre></div><blockquote><p>标签也可以在现有 pod 上进行添加和修改。 由于 pod kubia -manual 也是手动创建的， 所以为其添加 creation_method=manual 标签：</p></blockquote><p>修改标签</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl label po kubia-manual-v2 <span style=color:#79c0ff>env</span><span style=color:#ff7b72;font-weight:700>=</span>debug --overwrite
</span></span></code></pre></div><blockquote><p>修改现有的标签需要添加 &ndash;overwrite</p></blockquote><p><img src=/kubernet-in-action/3.3.3/2023-05-06_17-20.png alt=img></p><h3 id=34-通过标签选择器列出pod子集>3.4 通过标签选择器列出pod子集</h3><h4 id=341-使用标签选择器列出pod>3.4.1 使用标签选择器列出pod</h4><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get po -L <span style=color:#79c0ff>creation_method</span><span style=color:#ff7b72;font-weight:700>=</span>manua
</span></span></code></pre></div><p>查询不包括<code>env</code>的pod</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get po -l <span style=color:#a5d6ff>&#39;!env&#39;</span>
</span></span></code></pre></div><p>查询不包括<code>env</code>的pod</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get po -l <span style=color:#a5d6ff>&#39;env&#39;</span>
</span></span></code></pre></div><blockquote><p>加入 &ndash;show-labels 显示lables信息</p></blockquote><p>多种查询条件</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get po -l <span style=color:#a5d6ff>&#39;run=kubia&#39;</span> --show-labels
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl get po -l <span style=color:#a5d6ff>&#39;run!=kubia&#39;</span> --show-labels
</span></span></code></pre></div><p><img src=/kubernet-in-action/3.4.1/2023-05-06_17-42.png alt=img></p><h4 id=342-在标签选择器中使用多个条件>3.4.2 在标签选择器中使用多个条件</h4><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get po -l <span style=color:#a5d6ff>&#39;creation_method=manual,method=manual&#39;</span> --show-labels
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl get po -l <span style=color:#a5d6ff>&#39;creation_method=manual,method!=manual&#39;</span> --show-labels
</span></span></code></pre></div><p><img src=/kubernet-in-action/3.4.2/2023-05-06_17-45.png alt=img></p><h3 id=35-使用标签和选择器来约束pod调度>3.5 使用标签和选择器来约束pod调度</h3><h4 id=351-使用标签分类工作节点>3.5.1 使用标签分类工作节点</h4><p>假如node1 是SSD,node2 是hdd，某些环境需要ssd，可以通过labels 置顶调度到某个节点</p><p>假设我们集群中的 一个节点刚添加完成， 它包含一个用于通用GPU计算的GPU。 我们希望向节点添加标签来展示这个功能特性， 可以通过将 标签gpu=true添加到其中一个节点来实现（只需从kubectl get nodes返回的列表中选择一
个）：</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl label node node1 <span style=color:#79c0ff>gpu</span><span style=color:#ff7b72;font-weight:700>=</span>true
</span></span></code></pre></div><p><img src=/kubernet-in-action/3.5.1/2023-05-06_18-00.png alt=img></p><p>查询拥有gpu labels的node</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get node -l gpu
</span></span></code></pre></div><h4 id=352-将pod调度到特定节点>3.5.2 将pod调度到特定节点</h4><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Pod
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: kubia-gpu
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  nodeSelector:
</span></span><span style=display:flex><span>    gpu: <span style=color:#a5d6ff>&#34;true&#34;</span> <span style=color:#8b949e;font-style:italic>#node节点有gput=true的，则会调度到这个节点</span>
</span></span><span style=display:flex><span>  containers:
</span></span><span style=display:flex><span>  - image: luksa/kubia
</span></span><span style=display:flex><span>    name: kubia
</span></span></code></pre></div><h3 id=36-注解pod>3.6 注解pod</h3><h4 id=361-查找对象的注解>3.6.1 查找对象的注解</h4><p><img src=/kubernet-in-action/3.6.1/2023-05-06_18-10.png alt=img></p><h4 id=362-添加和修改注解>3.6.2 添加和修改注解</h4><p>给 <code>kubia-manual</code> pod添加注解</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl annotate pod kubia-manual mycompany.com/someannotation<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;foo bar&#34;</span>
</span></span></code></pre></div><p>查看注解</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl describe pod kubia-manual
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>#注解信息</span>
</span></span><span style=display:flex><span>Annotations:  mycompany.com/someannotation: foo bar
</span></span></code></pre></div><p><img src=/kubernet-in-action/3.6.2/2023-05-06_18-15.png alt=img></p><h3 id=37-使用命名空间对资源进行分组>3.7 使用命名空间对资源进行分组</h3><h4 id=372-发现其他命名空间及其-pod>3.7.2 发现其他命名空间及其 pod</h4><p>查看所有命名空间</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get ns
</span></span></code></pre></div><p>查看指定的命名空间pod,<code>kube-system</code></p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get po --namespace kube-system
</span></span></code></pre></div><hr width=100% id=EOF><p style=color:#777>Last modified on 2023-05-05</p></div></div><nav class=post-pagination><a class=newer-posts>Next<br>No newer posts.</a>
<a class=older-posts href=/posts/kubernets/>Previous<br>kubernets 部署</a></nav><div class=post-comment-wrapper><p style=opacity:.6 align=center><small>Comments Disabled.</small></p></div></div></div></div></div><div id=sideContainer class=side-container><a class="a-block nav-head false" href=https://www.okrust.com/><div class=nav-title>okrust</div></a><div class=nav-link-list><a class="a-block nav-link-item active" href=/posts>Archive</a>
<a class="a-block nav-link-item false" href=/tags>Tags</a>
<a class="a-block nav-link-item false" href=/categories>Categories</a></div><div class=nav-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://risehere.net/>Rise</a><br>Ported from <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal.</a><br><br>&copy;
okrust所有</div></div><div id=extraContainer class=extra-container><div class=toc-wrapper><div class=toc><div class=toc-content><center>- CATALOG -</center><ul><li><a href=#%e5%b8%b8%e7%94%a8%e6%8c%87%e4%bb%a4 class=nav-常用指令>常用指令</a></li><ul><li><a href=#2%e5%bc%80%e5%a7%8b%e4%bd%bf%e7%94%a8kubernets-%e5%92%8cdocker class=nav-2开始使用kubernets-和docker>2.开始使用kubernets 和docker</a></li><ul><li><a href=#1-%e5%88%9b%e5%bb%ba%e8%bf%90%e8%a1%8c%e5%8f%8a%e5%85%b1%e4%ba%ab%e5%ae%b9%e5%99%a8%e9%95%9c%e5%83%8f class=nav-1-创建运行及共享容器镜像>1. 创建、运行及共享容器镜像</a></li><li><a href=#3-%e8%bf%90%e8%a1%8c%e7%ac%ac%e4%b8%80%e4%b8%aa%e7%a8%8b%e5%ba%8f class=nav-3-运行第一个程序>3. 运行第一个程序</a></li><ul><li><a href=#2%e8%ae%bf%e9%97%ae%e7%ac%acweb-%e5%ba%94%e7%94%a8 class=nav-2访问第web-应用>2.访问第web 应用</a></li></ul></ul><li><a href=#3%e8%bf%90%e8%a1%8c%e4%ba%8ekuberntes-%e4%b8%ad%e7%9a%84%e5%ae%b9%e5%99%a8 class=nav-3运行于kuberntes-中的容器>3.运行于Kuberntes 中的容器</a></li><li><a href=#32-%e4%bb%a5yaml%e6%88%96%e8%80%85json%e6%96%87%e4%bb%b6%e5%88%9b%e5%bb%bapod class=nav-32-以yaml或者json文件创建pod>3.2 以YAML或者JSON文件创建pod</a></li><ul><ul><li><a href=#321-%e6%a3%80%e6%9f%a5%e7%8e%b0%e6%9c%89%e7%9a%84yaml%e6%8f%8f%e8%bf%b0 class=nav-321-检查现有的yaml描述>3.2.1 检查现有的yaml描述</a></li><li><a href=#323-kubectl-create-%e5%88%9b%e5%bb%bapod class=nav-323-kubectl-create-创建pod>3.2.3 kubectl create 创建pod</a></li><li><a href=#324-%e6%9f%a5%e7%9c%8b%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f%e6%97%a5%e5%bf%97 class=nav-324-查看应用程序日志>3.2.4 查看应用程序日志</a></li><li><a href=#325-%e5%90%91pod%e5%8f%91%e9%80%81%e8%af%b7%e6%b1%82 class=nav-325-向pod发送请求>3.2.5 向pod发送请求</a></li></ul><li><a href=#33-%e4%bd%bf%e7%94%a8%e6%a0%87%e7%ad%be%e7%bb%84%e7%bb%87pod class=nav-33-使用标签组织pod>3.3 使用标签组织pod</a></li><ul><li><a href=#332-%e5%88%9b%e5%bb%bapod%e6%a0%87%e7%ad%belabels class=nav-332-创建pod标签labels>3.3.2 创建pod标签labels</a></li><li><a href=#333-%e4%bf%ae%e6%94%b9%e6%b7%bb%e5%8a%a0pod-%e6%a0%87%e7%ad%be-labels class=nav-333-修改添加pod-标签-labels>3.3.3 修改添加pod 标签 labels</a></li></ul><li><a href=#34-%e9%80%9a%e8%bf%87%e6%a0%87%e7%ad%be%e9%80%89%e6%8b%a9%e5%99%a8%e5%88%97%e5%87%bapod%e5%ad%90%e9%9b%86 class=nav-34-通过标签选择器列出pod子集>3.4 通过标签选择器列出pod子集</a></li><ul><li><a href=#341-%e4%bd%bf%e7%94%a8%e6%a0%87%e7%ad%be%e9%80%89%e6%8b%a9%e5%99%a8%e5%88%97%e5%87%bapod class=nav-341-使用标签选择器列出pod>3.4.1 使用标签选择器列出pod</a></li><li><a href=#342-%e5%9c%a8%e6%a0%87%e7%ad%be%e9%80%89%e6%8b%a9%e5%99%a8%e4%b8%ad%e4%bd%bf%e7%94%a8%e5%a4%9a%e4%b8%aa%e6%9d%a1%e4%bb%b6 class=nav-342-在标签选择器中使用多个条件>3.4.2 在标签选择器中使用多个条件</a></li></ul><li><a href=#35-%e4%bd%bf%e7%94%a8%e6%a0%87%e7%ad%be%e5%92%8c%e9%80%89%e6%8b%a9%e5%99%a8%e6%9d%a5%e7%ba%a6%e6%9d%9fpod%e8%b0%83%e5%ba%a6 class=nav-35-使用标签和选择器来约束pod调度>3.5 使用标签和选择器来约束pod调度</a></li><ul><li><a href=#351-%e4%bd%bf%e7%94%a8%e6%a0%87%e7%ad%be%e5%88%86%e7%b1%bb%e5%b7%a5%e4%bd%9c%e8%8a%82%e7%82%b9 class=nav-351-使用标签分类工作节点>3.5.1 使用标签分类工作节点</a></li><li><a href=#352-%e5%b0%86pod%e8%b0%83%e5%ba%a6%e5%88%b0%e7%89%b9%e5%ae%9a%e8%8a%82%e7%82%b9 class=nav-352-将pod调度到特定节点>3.5.2 将pod调度到特定节点</a></li></ul><li><a href=#36-%e6%b3%a8%e8%a7%a3pod class=nav-36-注解pod>3.6 注解pod</a></li><ul><li><a href=#361-%e6%9f%a5%e6%89%be%e5%af%b9%e8%b1%a1%e7%9a%84%e6%b3%a8%e8%a7%a3 class=nav-361-查找对象的注解>3.6.1 查找对象的注解</a></li><li><a href=#362-%e6%b7%bb%e5%8a%a0%e5%92%8c%e4%bf%ae%e6%94%b9%e6%b3%a8%e8%a7%a3 class=nav-362-添加和修改注解>3.6.2 添加和修改注解</a></li></ul><li><a href=#37-%e4%bd%bf%e7%94%a8%e5%91%bd%e5%90%8d%e7%a9%ba%e9%97%b4%e5%af%b9%e8%b5%84%e6%ba%90%e8%bf%9b%e8%a1%8c%e5%88%86%e7%bb%84 class=nav-37-使用命名空间对资源进行分组>3.7 使用命名空间对资源进行分组</a></li><ul><li><a href=#372-%e5%8f%91%e7%8e%b0%e5%85%b6%e4%bb%96%e5%91%bd%e5%90%8d%e7%a9%ba%e9%97%b4%e5%8f%8a%e5%85%b6-pod class=nav-372-发现其他命名空间及其-pod>3.7.2 发现其他命名空间及其 pod</a></li></ul></div></div></div><div class=pagination><a id=globalBackToTop class="pagination-action animated-visibility" href=#top :class="{ invisible: scrollY == 0 }"><i class="material-icons pagination-action-icon">keyboard_arrow_up</i></a>
<a type=button class=pagination-action id=darkModeToggleButton><span class="material-icons pagination-action-icon" id=darkModeToggleIcon>dark_mode</span></a></div></div><div id=single-column-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://risehere.net/>Rise</a><br>Ported from <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal.</a><br><br>&copy;
okrust所有</div></div><script src=/js/journal.js></script></body></html>